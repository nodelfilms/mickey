{"version":3,"sources":["Avatar.js","Alert.js","server_api.js","Login.js","Navbar.js","ProjectWithFolders.js","ProjectsList.js","FileDropzone.js","File.js","TimeLeft.js","FolderStats.js","Breadcrumbs.js","Folder.js","User.js","NewProject.js","Project.js","index.js","App.js"],"names":["Avatar","props","url","crypto","createHash","update","email","trim","toLocaleLowerCase","digest","size","undefined","cls","className","react_default","a","createElement","src","height","alt","errorHandler","setAlert","msg","console","log","Alert","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","errormsg","setMsg","bind","assertThisInitialized","setState","role","Component","server_URL","test","window","location","origin","fetchStatusCheck","response","status","json","Promise","reject","statusText","onError","text","message","server_api","getProjectsList","func","fetch","method","headers","content-type","Authorization","getToken","then","catch","getProject","proj_id","addProject","name","description","body","JSON","stringify","updateProject","id","deleteProject","addFolder","project_id","folder_name","project","deleteFolder","folder_id","getFolder","getUsersList","addUser","updateUserProjects","user_id","action","updateUserName","getMe","getUser","deleteUser","getVersion","updateServer","renewAccessToken","session_key","onErr","startEmailAuthentification","finishEmailAuthentification","code","logout","uploadFile","file","onProgress","onDone","req","XMLHttpRequest","responseType","upload","addEventListener","event","lengthComputable","loaded","total","onload","resonse","formData","FormData","append","open","setRequestHeader","send","fileDownloadURL","file_id","token","accessToken","expiresAt","me","loggedIn","expiresIn","Date","getTime","localStorage","setItem","isAuthenticated","getItem","API","Login","_Component","logged_in","restoring_session","return_to","pathname","inputEmail","inputCode","wrong_email","wrong_code","code_sent","handleInputChange","performLogIn","from","removeItem","result","inherits","createClass","key","value","_this$setState","target","defineProperty","_this2","temp_key","preventDefault","no_user","react_router","to","onSubmit","width","type","placeholder","onChange","autoFocus","disabled","Logout","withRouter","redirect","history","push","MenuItem","where","react_router_dom","Navbar","data-toggle","data-target","aria-controls","aria-expanded","aria-label","render","p","is_admin","formatter","buildFormatter","ruStrings","Folder","empty","files_num","icon","animated","animate","lib_default","date","updated","onClick","callback","NewFolder","autoComplete","onAdd","htmlFor","maxLength","onEdit","length","onCancel","ProjectName","new_folder","href","ProjectWithFolders","new_folder_name","onNewFolder","onButtonCancel","onButtonAdd","onButtonDelete","folderAdded","folderDeleted","folder","folders","i","splice","unshift","sorted","sort","b","FoldersArray","f","ProjectsList","projects","loading","map","prj","src_ProjectWithFolders_0","FileDropzone","hightlight","fileInputRef","React","createRef","openFileDialog","onFilesAdded","onDragOver","onDragLeave","onDrop","current","click","evt","files","array","item","dataTransfer","children","style","cursor","ref","multiple","File","queued","index","FileQueued","uploading","progress","Math","round","FileUploading","error","error_text","FileError","download","saveRef","filesize","uploaded","user","FileNormal","Seconds","x","Minutes","FolderStats","stats","uploaded_so_far","percentage","time_left","uploading_now","total_to_upload","toFixed","upload_started","linkrefs","setTimeout","zip_token","mseq","fsecs","fhours","fmins","hours","floor","mins","secs","TimeLeft","total_uploaded","Breadcrumbs","parent_id","parent_name","aria-current","match","params","onCancelFile","onFileUpoaded","onUploadProgress","onUploadError","onFileListLoaded","new_files","added_size","duplicate","j","old_state","concat","rollQueue","uploads","next","to_upload","abort","copy","FileDropzone_FileDropzone","UserDescription","editing","projs","project_names","is_loaded","is_deleting","clb","onEditNameButton","onNameChangeButton","nameEdit","onCancelButton","onDeleteUser","ServerStatus","updates","hash","uptime_starts","current_hash","current_name","current_date","User","is_deleted","version_info","cached_id","onUpdateServer","json2","loadUserInfo","_this3","updateMe","_this4","_this5","NewProject","processing","processed","onCreate","onCreated","required","rows","NewUser","email_valid","e","m","emailIsValid","user_email","onNewUserButton","onCreateUserButton","user_name","ProjectDescription","folders_num","onEditDescButton","onDescChangeButton","descEdit","created","onDeleteProject","Project","participants","Set","users","moved_user","onAddUser","onProjectLoaded","onUserCreated","newstate","sel","add","delete","new_users","others","has","Project_User","ReactDOM","exact","path","component","Projects","Folder_Folder","Project_Project","User_User","Alert_Alert","document","getElementById"],"mappings":"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","file":"static/js/main.a86c5d7f.chunk.js","sourcesContent":["import React    from 'react';\r\nimport crypto   from 'crypto';\r\n\r\nexport default function Avatar(props) {\r\n    const md5 = crypto.createHash('md5').update(props.email.trim().toLocaleLowerCase()).digest('hex');\r\n    const url = 'https://www.gravatar.com/avatar/' + md5  + '?d=identicon';\r\n    const size = ( props.size === undefined ) ? '30px' : props.size+'px';\r\n    const cls = props.className || '';\r\n    return (<img src={url} height={size} alt='avatar' className={'rounded-circle '+cls} />);\r\n} ","import React, { Component } from 'react';\r\n\r\n// пока пустой указатель, инициализируем позже, когда создатся экземпляр реакт-класса\r\nlet errorHandler = null;\r\n\r\n// Обновляем состояние баннера на новый текст ошибки\r\nexport function setAlert (msg){\r\n    if (errorHandler === null)\r\n    {\r\n        if( msg !== null )\r\n            return console.log(\"Error: setAlert() called before instantiating <Alert />, ignored. Message: \", msg);\r\n        else\r\n            return;\r\n    }\r\n    errorHandler(msg);\r\n}\r\n\r\n// класс показывает баннер с ошибкой, если она установлена не в null\r\nexport default class Alert extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = { errormsg: null };\r\n\r\n        if ( errorHandler !== null )\r\n            console.log(\"Warning: there can be only one instance of <Alert /> in application.\");\r\n        errorHandler = this.setMsg.bind(this);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        errorHandler = null;\r\n    }    \r\n\r\n    setMsg(msg) {\r\n        this.setState({ errormsg: msg });\r\n    }\r\n\r\n    render () {\r\n        if (this.state.errormsg === null)\r\n            return ('');\r\n        else\r\n            return (<aside className=\"fixed-bottom bg-danger border border-white text-white p-2\" role=\"alert\"> {this.state.errormsg} </aside>);\r\n    }\r\n}\r\n","import { setAlert } from './Alert';\r\nimport { getToken } from './Login';\r\n\r\n// автоматически определяем куда коннектится в зависимости от того, \r\n// в проде мы или на локальной машине\r\nconst server_URL = /localhost/.test(window.location.origin) ? \r\n                        'http://localhost:8000' :  // сервер на локальной машине\r\n                        'https://tomater.synology.me:8000'; // NAS, опубликованный в интернет\r\n\r\n\r\n// стандартная функция обработки статуса ответа сервера\r\nfunction fetchStatusCheck(response){\r\n    switch (response.status) {\r\n        case 200:\r\n            return (response.json());\r\n        case 401:\r\n            // проблема с токеном аутентификации - надо идти снова к странице логина\r\n            return Promise.reject(\"Error 401: Token is not correct.\");\r\n        default:\r\n            return Promise.reject('Server reply: '+ response.status + '; ' + response.statusText);\r\n    }\r\n}\r\n\r\nfunction onError (msg){\r\n    let text = \"Server-api/onError: unknown type of error...\";\r\n    if (typeof msg == 'object')\r\n    {\r\n        console.log(msg); // TODO.. Remove?\r\n        text = msg.message; // ошибка от fetch?\r\n    }\r\n    else if (typeof msg == 'string'){\r\n      text = msg;\r\n    }\r\n    setAlert(text);\r\n}\r\n\r\nexport default {\r\n    // получение списка проектов с сервера\r\n    getProjectsList: (func) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/projects\", {\r\n            method: 'get',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // получение описания проекта с сервера\r\n    getProject: (func, proj_id) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/projects/\" + proj_id, {\r\n            method: 'get',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // добавить новый проект\r\n    // {\r\n    //    name:        string,  // название нового проекта, до 50 символов. Не может быть пустым\r\n    //    description: string   // описание новго проектаб до 200 символов. Допускается пустое\r\n    // }\r\n    // Возвращает описание проекта\r\n    addProject: (func, name, description) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/projects\", {\r\n            method: 'post',\r\n            body: JSON.stringify({ name, description }),\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // обновить описание проекта\r\n    // {\r\n    //    name:        string,  // новое название проекта, до 50 символов. Не может быть пустым\r\n    //    description: string   // новое описание проектаб до 200 символов. Допускается пустое\r\n    // }\r\n    // Возвращает описание проекта\r\n    updateProject: (func, id, name, description) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/projects/\" + id, {\r\n            method: 'put',\r\n            body: JSON.stringify({ name, description }),\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // удалить проект\r\n    deleteProject: (func, id) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/projects/\" + id, {\r\n            method: 'delete',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },    \r\n\r\n    // добавить новый фолдер к проекту\r\n    // На входе JSON в теле\r\n    // {\r\n    //    project: string,  // UUID родительского проекта\r\n    //    name:    string   // название для новой папки\r\n    // }    \r\n    addFolder: (func, project_id, folder_name) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/folders\", {\r\n            method: 'post',\r\n            body: JSON.stringify({project: project_id, name: folder_name}),\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // удалить пустой фолдер \r\n    // На входе id\r\n    // На выходе тот же id, если все успешно\r\n    deleteFolder: (func, folder_id) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/folders/\"+folder_id, {\r\n            method: 'delete',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then( json => func(json.id) )\r\n        .catch(onError);\r\n    },\r\n\r\n    // считать папку с файлами\r\n    // На входе id\r\n    // На выходе JSON про папку и все ее файлы\r\n    getFolder: (func, folder_id) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/folders/\"+folder_id, {\r\n            method: 'get',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // получить список всех пользователей\r\n    // На выходе JSON с массивом\r\n    getUsersList: (func) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/users\", {\r\n            method: 'get',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // Создать нового пользователя\r\n    // На входе JSON в теле\r\n    // {\r\n    //    name:    string   // имя пользователя (максимум 50 символов)\r\n    //    email:   string   // email (максимум 50 символов)\r\n    //    project: string   // uuid проекта, к которому даем права сразу\r\n    // }\r\n    // возвращает JSON c описанием нового пользователя\r\n    addUser: (func, name, email, project ) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/users\", {\r\n            method: 'post',\r\n            body: JSON.stringify({name, email, project}),\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n\r\n    // обновление информации о пользователе - пока только доступные проекты\r\n    // позже, возможно, профиль\r\n    // На входе JSON в теле\r\n    // {\r\n    //    project: string               // uuid проекта, к которому даем/забираем права сразу\r\n    //    action:  string (add|delete)  // забрать или добавить прав\r\n    // }\r\n    // не возвращаем ничего\r\n    updateUserProjects: (func, user_id, project, action ) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/users/\" + user_id, {\r\n            method: 'put',\r\n            body: JSON.stringify({project, action}),\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // обновление информации о пользователе - пока только доступные проекты\r\n    // позже, возможно, профиль\r\n    // На входе JSON в теле\r\n    // {\r\n    //    name: string               // имя, на которое заменяем старое (максимум 50 символов)\r\n    // }\r\n    // не возвращаем ничего\r\n    updateUserName: (func, user_id, name ) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/users/\" + user_id, {\r\n            method: 'put',\r\n            body: JSON.stringify({name}),\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // получить информацию о текущем пользователе\r\n    getMe: (func) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/users/me\", {\r\n            method: 'get',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },\r\n\r\n    // получить информацию о текущем пользователе по ID\r\n    getUser: (func, user_id) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/users/\" + user_id, {\r\n            method: 'get',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },    \r\n\r\n    // удалить пользователя\r\n    deleteUser: (func, user_id) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/users/\" + user_id, {\r\n            method: 'delete',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },    \r\n\r\n    // получить информацию о текуцей версии приложения сервера\r\n    getVersion: (func) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/version\",  {\r\n            method: 'get',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },    \r\n\r\n    // перезапустить и обновить сервер\r\n    updateServer: (func) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/version\",  {\r\n            method: 'post',\r\n            headers: { 'content-type': 'application/json', 'Authorization': 'Bearer ' + getToken() }})\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onError);\r\n    },    \r\n\r\n\r\n    // обновить токен доступа\r\n    renewAccessToken: (func, session_key, onErr) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/auth/renewAccessToken\",  {\r\n            method: 'post',\r\n            body: JSON.stringify({session_key}),\r\n            headers: { 'content-type': 'application/json' },\r\n        })\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onErr?onErr:onError);\r\n    },    \r\n\r\n\r\n    // начать процесс аутентификации через отправку письма\r\n    startEmailAuthentification: (func, email, onErr) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/auth/startEmailAuthentification\",  {\r\n            method: 'post',\r\n            body: JSON.stringify({email}),\r\n            headers: { 'content-type': 'application/json' },\r\n        })\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onErr?onErr:onError);\r\n    },    \r\n\r\n\r\n    // начать процесс аутентификации через отправку письма\r\n    finishEmailAuthentification: (func, session_key, code, onErr) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/auth/finishEmailAuthentification\",  {\r\n            method: 'post',\r\n            body: JSON.stringify({session_key, code}),\r\n            headers: { 'content-type': 'application/json' },\r\n        })\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onErr?onErr:onError);\r\n    },    \r\n\r\n    // разлогировать пользователя\r\n    logout: (func, session_key, onErr) => {\r\n        setAlert(null);\r\n        return fetch(server_URL + \"/auth/logout\",  {\r\n            method: 'post',\r\n            body: JSON.stringify({session_key}),\r\n            headers: { 'content-type': 'application/json' },\r\n        })\r\n        .then(fetchStatusCheck)\r\n        .then(func)\r\n        .catch(onErr?onErr:onError);\r\n    },        \r\n\r\n    // загрузить файл на сервер\r\n    // на входе - \r\n    //  id родительской папочки\r\n    //  объект file\r\n    //     - коллбек для отслеживания прогресса загрузки\r\n    //     - колбек на окончание загрузки\r\n    //     - колбек на ошибку загрузки\r\n    //\r\n    //  возращает ссылку на риквест (чтобы отменить можно было)\r\n    uploadFile: (folder_id, file, onProgress, onDone, onError) => {\r\n        const req = new XMLHttpRequest();\r\n        req.responseType = 'json';\r\n\r\n        req.upload.addEventListener(\"progress\", event => {\r\n            if (event.lengthComputable)\r\n                onProgress(file.name, (event.loaded / event.total) * 100);\r\n        });\r\n        \r\n        req.onload = function () {\r\n            if ( req.resonse === null )\r\n                onError(file.name, \"Ошибка загрузки\" );\r\n            else\r\n                onDone(file.name, req.response); \r\n        }\r\n\r\n        req.upload.addEventListener(\"error\", event => {\r\n            // пока не удалось найти хоть какие-то признаки,\r\n            // позвояющие идентифицировать ошибку \r\n            // возможные причины - сервер не отвечает, это не файл, а папка, к файлу нет доступа\r\n            onError(file.name, \"Ошибка загрузки\" );\r\n        });\r\n    \r\n        const formData = new FormData();\r\n        formData.append(\"file\", file, file.name);\r\n        formData.append(\"folder\", folder_id);\r\n    \r\n        req.open(\"POST\", server_URL + \"/files\");\r\n        req.setRequestHeader('Authorization', 'Bearer ' + getToken() );\r\n        req.send(formData);\r\n\r\n        return req;\r\n    },\r\n\r\n    // правльная ссылка на скачивание файла\r\n    fileDownloadURL: (file_id, token) => {\r\n        return (server_URL + '/files/' + file_id + '?token=' + token);\r\n    }\r\n};\r\n\r\n","import React, { Component } from 'react';\r\nimport { Redirect, withRouter } from \"react-router-dom\";\r\nimport API                  from './server_api'\r\n\r\nimport './Login.css'\r\n\r\nlet accessToken = null;\r\nlet expiresAt   = 0;\r\nlet me          = null;\r\n\r\nfunction loggedIn (json) {\r\n    accessToken = json.token;\r\n    expiresAt   = (json.expiresIn * 1000) + new Date().getTime();\r\n    localStorage.setItem('session_key', json.session_key);\r\n}\r\n\r\nexport function getToken(){\r\n    return accessToken;\r\n}\r\n\r\nexport function getMe(){\r\n    return me;\r\n}\r\n\r\nexport function updateMe(json){\r\n    me=json;\r\n}\r\n\r\nexport function isAuthenticated () {\r\n    if ( accessToken === null || me === null ) {\r\n        return false;\r\n    }\r\n    else {\r\n        const now = new Date().getTime();\r\n        // через 10 минут устареет? надо бы обновить. Обычно они на час выдаются\r\n        if ( now + 10*60*1000 >= expiresAt ){\r\n            let session_key = localStorage.getItem('session_key');            \r\n            API.renewAccessToken(loggedIn, session_key);\r\n        }\r\n        // пока считаем, что все норм, токен есть и он не очень старый, либо вот-вот обновится\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class Login extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { \r\n            logged_in:   isAuthenticated(), // есть ли уже токен доступа к серверу и  информация о пользователе ?\r\n\r\n            restoring_session: false,       // на время восстановления старой сессии не будем ничего рисовать на экране, чтобы не мелькало\r\n            return_to:   { pathname: '/' }, // куда вернемся после восстановления сессии - если не было сюда явного редиректа - вернемся в корень\r\n\r\n            inputEmail:  '',                // поля ввода в форме\r\n            inputCode:   '',\r\n\r\n            wrong_email: false,             // состояния UI\r\n            wrong_code:  false,             // состояния UI\r\n            code_sent:   false,\r\n        };\r\n\r\n        this.handleInputChange = this.handleInputChange.bind(this);\r\n        this.performLogIn      = this.performLogIn.bind(this);\r\n\r\n        // запоминаем, откуда нас сюда заредиректили, чтобы потом вернуться\r\n        if ( this.props.location.state !== undefined )\r\n            this.state.return_to =  this.props.location.state.from;\r\n\r\n        // может быть не аутентифицированы сейчас, но были при прошлом посещении страницы?\r\n        let session_key = localStorage.getItem('session_key');            \r\n        if ( accessToken === null &&  session_key ) {\r\n            // флаг, предотвращающий мелькание экрана\r\n            this.state.restoring_session = true;\r\n            // на случай ошибки сбрасываем флаг наличия сессии, чтобы не было бесконечного цикла\r\n            localStorage.removeItem('session_key');\r\n            // пытаемся восстановить токен с сервера \r\n            API.renewAccessToken(result=>{\r\n                loggedIn(result);\r\n                API.getMe((json) => {\r\n                    me = json;\r\n                    this.setState({ logged_in: true })\r\n                });\r\n            }, session_key, ()=>{\r\n                // попытка залогиниться не прошла, рисуем форму логина\r\n                this.setState({ restoring_session: false })\r\n            });\r\n        }\r\n\r\n        // странная ситуация - есть токен, но не загружена информация о себе - загружаем\r\n        if ( accessToken !== null && me === null ) {\r\n            API.getMe((json) => {\r\n                me = json;\r\n                this.setState({ logged_in: true })\r\n            });\r\n        }\r\n    }\r\n\r\n    handleInputChange(event) {\r\n        const target = event.target;\r\n        this.setState({ [target.id]: target.value, wrong_email: false, wrong_code: false });\r\n    }\r\n\r\n    performLogIn(event){\r\n        if ( this.state.code_sent === false ){ \r\n            API.startEmailAuthentification(json=>{\r\n                this.setState ({ code_sent: true, wrong_email: false, temp_key: json.session_key });\r\n            }, this.state.inputEmail, ()=>{\r\n                this.setState ({ code_sent: false, wrong_email: true });\r\n            });\r\n        }\r\n        else {\r\n            API.finishEmailAuthentification(json=>{\r\n                loggedIn(json);\r\n                this.setState ({ logged_in: true });\r\n            }, this.state.temp_key, this.state.inputCode, ()=>{\r\n                this.setState ({ wrong_code: true });\r\n            });\r\n        }\r\n        event.preventDefault();\r\n    }\r\n    \r\n    render () {\r\n        const no_user = this.state.wrong_email;\r\n        const wrong_code = this.state.wrong_code;\r\n\r\n        if ( this.state.logged_in )\r\n            return <Redirect to={this.state.return_to} />;\r\n        else if ( this.state.restoring_session )\r\n            return <center><h4 className='p-4 text-muted'>Logging in, please wait...</h4></center> ; // не мелькаем экраном на вермя восстановления сессии\r\n        else\r\n            return (\r\n            <main>\r\n                <form className=\"form-signin text-center my-5\" onSubmit = { this.performLogIn }>\r\n                    <img className=\"mb-4\" src=\"https://www.nodelfilms.com/assets/icons/nodelfilms-icon.svg\" alt=\"\" width=\"72\" height=\"72\" />\r\n                    <h1 className=\"h3 mb-3 font-weight-normal\">\r\n                        Вход только для зарегистрированны пользователей\r\n                    </h1>\r\n                    {\r\n                        this.state.code_sent && \r\n                        <p className='text-secondary'>\r\n                            Код подтверждения отправлен на указанную почту. Для входа, введите код в поле ниже:\r\n                        </p>\r\n                    }\r\n                    <div className=\"input-group\">\r\n                        { this.state.code_sent || \r\n                            <div className=\"input-group-prepend\">\r\n                                <span className=\"input-group-text\">@</span>\r\n                            </div>\r\n                        }\r\n                    <input type= { this.state.code_sent ? 'hidden' : 'email' }\r\n                           id=\"inputEmail\" \r\n                           className={ no_user ? \"form-control is-invalid\" : \"form-control\" }\r\n                           placeholder=\"Email\" \r\n                           value={this.state.inputEmail} \r\n                           onChange={this.handleInputChange}\r\n                           autoFocus={true}/>\r\n                    { no_user &&\r\n                        <div className=\"invalid-feedback\">\r\n                            Пользователь не зарегистрирован\r\n                        </div>\r\n                    }\r\n                    </div>\r\n                    <input type={ this.state.code_sent ? 'number' : 'hidden' }\r\n                           id=\"inputCode\"\r\n                           className={ wrong_code ? \"form-control is-invalid\" : \"form-control\" }\r\n                           placeholder=\"Код из письма\" \r\n                           value={this.state.inputCode} \r\n                           onChange={this.handleInputChange}\r\n                           autoFocus={true}/>\r\n                    { wrong_code &&\r\n                        <div className=\"invalid-feedback\">\r\n                            Неверный код\r\n                        </div>\r\n                    }\r\n                    <button className=\"btn btn-primary btn-block my-2\" type=\"submit\" disabled={wrong_code} >\r\n                        { this.state.code_sent ? ' Проверить код' : ' Получить код для входа' }\r\n                    </button>\r\n                    <p className=\"mt-5 mb-3 text-muted\">\r\n                        © 2019, nodelfilms.com\r\n                    </p>\r\n                </form>\r\n            </main> \r\n        );\r\n    }    \r\n}\r\n\r\nexport const Logout = withRouter((props) => {\r\n    if ( accessToken !== null ){\r\n        // Remove session_key from localStorage\r\n        let session_key = localStorage.getItem('session_key'); \r\n\r\n        me = null;\r\n        accessToken = null;\r\n        localStorage.removeItem('session_key');\r\n\r\n        function redirect () {\r\n            props.history.push(\"/login\");            \r\n        }\r\n    \r\n        API.logout(redirect, session_key, redirect);\r\n\r\n        // это будет отображено на экране на короткое время, \r\n        // пока идет запрос к серверу авторизации\r\n        // потом будет редирект страницу логина\r\n        return (<center><h4 className='p-4 text-muted'>Logging out, please wait...</h4></center>);\r\n    }\r\n    else{\r\n        return <Redirect to={'/login'} />;\r\n    }\r\n});","import React           from 'react';\r\nimport { Route, Link } from 'react-router-dom';\r\nimport Avatar          from './Avatar';\r\nimport { getMe }       from './Login';\r\n\r\nfunction MenuItem (props) {\r\n    if (props.where === props.to){\r\n        return (\r\n            <li className=\"nav-item active\">\r\n                <div className=\"nav-link\">{props.text}</div>\r\n            </li>\r\n        );\r\n    }\r\n    else {\r\n        return (\r\n            <li className=\"nav-item\">\r\n                <Link className=\"nav-link\" to={props.to}>{props.text}</Link>\r\n            </li>\r\n        );\r\n    }\r\n}\r\n\r\nexport default function Navbar(props) {\r\n    const me = ( props.me !== undefined ) ? props.me : getMe();\r\n    return (\r\n        <nav className=\"navbar navbar-expand-sm navbar-dark bg-dark\">\r\n            <button className=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarNav\" aria-controls=\"navbarNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n                <span className=\"navbar-toggler-icon\"></span>\r\n            </button>\r\n            <div className=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n                <ul className=\"navbar-nav\">\r\n                    <Route render={ (p)=> <MenuItem where={p.location.pathname} text=\"Начало\" to=\"/\" /> } />\r\n                    { me.is_admin && \r\n                        <Route render={ (p)=> <MenuItem where={p.location.pathname} text=\"Новый проект\" to=\"/new_project\"  /> } /> }\r\n                    <Route render={ (p)=> <MenuItem where={p.location.pathname} text=\"Выйти\" to=\"/logout\"  /> } />\r\n                </ul>\r\n            </div>\r\n            <li className=\"navbar-text dropdown\">\r\n                <Avatar email={me.email} size='30' />\r\n                <span className='ml-2'><Link to={'/user/'+me.id} className='text-white-50'>{me.name}</Link></span>\r\n            </li>\r\n        </nav>\r\n    );\r\n}\r\n","import React, { Component } from 'react';\r\nimport { Link }             from 'react-router-dom';\r\n\r\nimport TimeAgo              from 'react-timeago';\r\nimport ruStrings            from 'react-timeago/lib/language-strings/ru'\r\nimport buildFormatter       from 'react-timeago/lib/formatters/buildFormatter'\r\n\r\nimport API                  from './server_api'\r\n\r\nimport './ProjectWithFolders.css';\r\n\r\nconst formatter = buildFormatter(ruStrings);\r\n\r\nfunction Folder(props) {\r\n    const empty = (props.files_num === 0);\r\n    const icon = empty ? \"img/folder-empty.svg\" : \"img/folder.svg\";\r\n    const animated = (props.animate===true) ? \"folder-animated \" : \"\";\r\n    return (\r\n        <div className={ animated + \"list-group-item\" } key={props.id}>\r\n            <div className=\"d-flex w-100 justify-content-between\">\r\n                <div className=\"media\">\r\n                    <Link to={\"/folder/\"+props.id} className=\"align-self-center\">\r\n                        <img src={icon} className=\"mr-3\" height=\"66\" alt=\"folder\" />\r\n                    </Link>\r\n                    <div className=\"media-body\">\r\n                        <Link to={\"/folder/\"+props.id} className='text-dark'>\r\n                            <h4 className=\"mt-0 mb-0 text-break\">{props.name}</h4>\r\n                        </Link>\r\n                        <small>\r\n                        { empty ? \r\n                            <p className=\"mb-0 text-secondary\">Нет файлов</p> :\r\n                            <p className=\"mb-0 text-secondary\">Файлов: {props.files_num}</p> \r\n                        } \r\n                        <p className=\"mb-0 text-secondary\">\r\n                            <TimeAgo date={props.updated} formatter={formatter} />\r\n                        </p>\r\n                        </small>\r\n                    </div>\r\n                </div>\r\n                { empty && <button type=\"button\" className=\"close\" onClick={props.callback} id={props.id}>&times;</button> }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction NewFolder(props) {\r\n    return (\r\n        <form className=\"form-inline mt-3\" autoComplete=\"off\" onSubmit={props.onAdd}>\r\n            <label className=\"sr-only\" htmlFor=\"folderName\">Name</label>\r\n            <input type=\"text\" maxLength=\"50\" className=\"form-control mb-2 mr-sm-2\" id=\"folderName\" \r\n                placeholder=\"Название папки\" onChange={props.onEdit} value={props.text}/>\r\n            { props.text.length >  0 ?\r\n                <button type=\"submit\" className=\"btn btn-primary btn-sm mb-2 mr-2\">Создать</button> :\r\n                <button type=\"submit\" className=\"btn btn-primary btn-sm mb-2 mr-2\" disabled>Создать</button>\r\n            }\r\n            <button className=\"btn btn-primary btn-sm mb-2\" onClick={props.onCancel}>Отмена</button>\r\n        </form>        \r\n    );\r\n}\r\n\r\nfunction ProjectName(props) {\r\n    return (\r\n        <div>\r\n            <div className=\"row mt-3\">\r\n                <div className=\"col-sm-8 mx-1\">\r\n                    <Link to={ '/project/' + props.id } className='text-dark mb-0'>\r\n                        <h2> {props.name}</h2>\r\n                    </Link>\r\n                </div>\r\n                <div className=\"col-sm mx-1 pt-sm-2 text-sm-right\">\r\n                    <small className=\"text-muted\"><TimeAgo date={props.updated} formatter={formatter}/></small>\r\n                </div>\r\n            </div>\r\n            <div className=\"row\">\r\n                <div className=\"col mx-1\">\r\n                    <p className=\"mb-0\">{props.description}</p>\r\n                </div>        \r\n            </div>\r\n            <div className=\"row\">\r\n                <div className=\"col mx-1\">\r\n                    { props.new_folder || <a href=\"/#\" onClick={props.onClick}><small>Добавить папку »</small></a> }\r\n                </div>        \r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nclass ProjectWithFolders extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state              = props.project;\r\n        this.state.new_folder   = false;\r\n        this.state.new_folder_name = '';\r\n\r\n        this.onNewFolder        = this.onNewFolder.bind(this);\r\n        this.onCancel           = this.onButtonCancel.bind(this);\r\n        this.onAdd              = this.onButtonAdd.bind(this);\r\n        this.handleInputChange  = this.handleInputChange.bind(this);\r\n        this.onButtonAdd        = this.onButtonAdd.bind(this);\r\n        this.onButtonDelete     = this.onButtonDelete.bind(this);\r\n        this.onButtonCancel     = this.onButtonCancel.bind(this);\r\n        this.folderAdded        = this.folderAdded.bind(this);\r\n        this.folderDeleted      = this.folderDeleted.bind(this);\r\n    }\r\n\r\n    onNewFolder(event){\r\n        event.preventDefault();\r\n        this.setState({ new_folder: true, new_folder_name: '' });\r\n    }\r\n\r\n    onButtonAdd(event){\r\n        event.preventDefault();\r\n        this.setState({ new_folder: false });\r\n        API.addFolder(this.folderAdded, this.state.id, this.state.new_folder_name);\r\n    }\r\n\r\n    onButtonCancel(event){\r\n        event.preventDefault();\r\n        this.setState({ new_folder: false });\r\n    }\r\n\r\n    onButtonDelete(event){\r\n        event.preventDefault();\r\n        API.deleteFolder(this.folderDeleted, event.target.id);\r\n    }\r\n\r\n    folderAdded(folder){\r\n        let folders = this.state.folders;\r\n        // если создаем папку с дублирующимся имеем, сервер не создаст новую папку,\r\n        // а вернет уже существующую с тем же именем. проверяем уникальность\r\n        for (let i=0; i<folders.length; i++){\r\n            folders[i].animate = false;\r\n            if ( folders[i].id === folder.id ){\r\n                // удаляем, чтобы затем добавить на вершину списка\r\n                folders.splice(i,1);\r\n                i--;\r\n            }\r\n        }\r\n        // эту папочку нужно красиво появить на экране\r\n        folder.animate = true;\r\n        folders.unshift(folder);\r\n        this.setState({ folders: folders });\r\n    }\r\n\r\n    folderDeleted(id){\r\n        let folders = [];\r\n        // сохраняем все, кроме удаленной папки\r\n        for (let i in this.state.folders)\r\n            if ( this.state.folders[i].id !== id )\r\n                folders.push(this.state.folders[i]);\r\n        this.setState({ folders: folders });\r\n    }\r\n\r\n    handleInputChange(event) {\r\n        switch (event.target.id){\r\n            case 'folderName':\r\n                this.setState({ new_folder_name: event.target.value});\r\n                break;\r\n            default:\r\n        }\r\n    }    \r\n \r\n    render() {\r\n        // строим массив фолдеров\r\n        const sorted = this.state.folders.sort( (a,b)=>{ return new Date(b.updated)-new Date(a.updated);} );\r\n        const FoldersArray=[];\r\n        for (let i in sorted ){\r\n            // добавляем сслыку на колбэк\r\n            let f = sorted[i];\r\n            f.callback = this.onButtonDelete;\r\n            FoldersArray.push(Folder(f));\r\n        }\r\n        // рендерим\r\n        return (\r\n            <div className=\"mb-4\">\r\n                <ProjectName \r\n                    id={this.state.id} \r\n                    name={this.state.name} \r\n                    updated={this.state.updated} \r\n                    onClick={this.onNewFolder} \r\n                    new_folder={this.state.new_folder}/>\r\n                    \r\n                { this.state.new_folder && <NewFolder \r\n                    onAdd={this.onButtonAdd} \r\n                    onCancel={this.onButtonCancel} \r\n                    onEdit={this.handleInputChange} \r\n                    text={this.state.new_folder_name}/> }\r\n\r\n                <div className=\"list-group shadow mt-3\">\r\n                    {FoldersArray}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default ProjectWithFolders;\r\n","import React, { Component } from 'react';\r\nimport { Redirect }         from \"react-router-dom\";\r\n\r\nimport Navbar               from './Navbar';\r\nimport Project              from './ProjectWithFolders'\r\nimport API                  from './server_api'\r\nimport { isAuthenticated }  from './Login'\r\n\r\n\r\n// выводим подряд все проекты\r\nexport default class ProjectsList extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { \r\n            projects: null,\r\n            loading:  true,  // пока еще загружаем список проектов\r\n        };\r\n    }\r\n    \r\n    componentWillMount() {\r\n        // Теперь время загрузить список проектов с сервера\r\n        if ( isAuthenticated() )\r\n            API.getProjectsList( (json)=>{this.setState({ projects: json, loading: false });} );\r\n    }\r\n\r\n    render () {\r\n        // неавторизованных пользователей перенаправляем на страницу логина\r\n        if ( !isAuthenticated() )\r\n            return (<Redirect to={{ pathname: \"/login\", state: { from: this.props.location }}} />);\r\n\r\n        let projects = [];\r\n        if ( this.state.projects !== null )\r\n            projects = this.state.projects.map( prj => { return <Project project={prj} key={prj.id}/>; } );\r\n\r\n        return ([\r\n            <Navbar key='navbar' />,\r\n            <main key='body' role=\"main\" className=\"container\">\r\n                {projects}\r\n                { this.state.loading || projects.length > 0 ||\r\n                    <center className=\"p-4\">\r\n                        <img className=\"m-4\" src=\"http://nodelfilms.com/assets/icons/nodelfilms-icon.svg\" alt=\"\" width=\"72\" height=\"72\" />\r\n                        <h3 >Вы сейчас не участвуете ни в одном из проектов.</h3>\r\n                        <p>Если это не так, то свяжитесь с нами, чтобы мы настроили Вам права доступа.</p>\r\n                    </center>                \r\n                }\r\n            </main>\r\n        ]);\r\n    }\r\n}\r\n","import React, { Component } from 'react';\r\n\r\nimport './FileDropzone.css';\r\n\r\nexport default class FileDropzone extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = { hightlight: \"\" };\r\n        this.fileInputRef = React.createRef();\r\n\r\n        this.openFileDialog = this.openFileDialog.bind(this);\r\n        this.onFilesAdded   = this.onFilesAdded.bind(this);\r\n        this.onDragOver     = this.onDragOver.bind(this);\r\n        this.onDragLeave    = this.onDragLeave.bind(this);\r\n        this.onDrop         = this.onDrop.bind(this);\r\n    }\r\n\r\n    openFileDialog() {\r\n        this.fileInputRef.current.click();\r\n    }\r\n\r\n    onFilesAdded(evt) {\r\n        // преобразуем список в обычный массив\r\n        const files = evt.target.files;\r\n        let array =[];\r\n        for (var i = 0; i < files.length; i++)\r\n            array.push(files.item(i));\r\n        // вызываем колбек\r\n        if (this.props.onFilesAdded)\r\n            this.props.onFilesAdded(array);\r\n    }\r\n\r\n    onDrop(event) {\r\n        event.preventDefault();\r\n        // преобразуем список в обычный массив\r\n        const files = event.dataTransfer.files;\r\n        let array =[];\r\n        for (var i = 0; i < files.length; i++)\r\n            array.push(files.item(i));\r\n        // вызываем колбек\r\n        if (this.props.onFilesAdded)\r\n            this.props.onFilesAdded(array);\r\n        this.setState({ hightlight: \"\" });\r\n    }\r\n\r\n    onDragOver(evt) {\r\n        evt.preventDefault();\r\n        this.setState({ hightlight: \"ZoneHighlight\" });\r\n    }\r\n\r\n    onDragLeave() {\r\n        this.setState({ hightlight: \"\" });\r\n    }\r\n  \r\n    render() {\r\n        return (\r\n            <div className={\"p-1 \" + this.state.hightlight } \r\n                onDragOver={this.onDragOver} \r\n                onDragLeave={this.onDragLeave} \r\n                onDrop={this.onDrop} >\r\n\r\n                {this.props.children}\r\n                \r\n                <div className=\"d-flex w-100 flex-column align-items-center my-4 p-4 Dropzone\">\r\n\r\n                    <img src=\"img/cloud-upload.svg\" \r\n                        alt=\"upload\" \r\n                        height=\"150\" \r\n                        onClick={this.openFileDialog} \r\n                        style={{ cursor: \"pointer\" }} />\r\n                    \r\n                    <input ref={this.fileInputRef} \r\n                        className=\"InvisibleFileInput\" \r\n                        type=\"file\" multiple \r\n                        onChange={this.onFilesAdded} />\r\n                    \r\n                    <button type=\"button\" \r\n                        className=\"btn btn-secondary btn-lg mb-3\" \r\n                        onClick={this.openFileDialog}>Загрузите файлы</button>\r\n                    \r\n                    <center><p>Или перетащите файлы сюда для закачки</p></center>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import React    from 'react';\r\nimport filesize from 'filesize'\r\n\r\nimport TimeAgo              from 'react-timeago';\r\nimport ruStrings            from 'react-timeago/lib/language-strings/ru'\r\nimport buildFormatter       from 'react-timeago/lib/formatters/buildFormatter'\r\n\r\nimport API                  from './server_api'\r\n\r\nconst formatter = buildFormatter(ruStrings);\r\n\r\n\r\nfunction FileUploading(props) {\r\n    return (\r\n        <div className=\"d-flex w-100\">\r\n            <div className=\"align-self-center mx-3\">\r\n                <img src=\"img/cloud-upload-gray.svg\" height=\"50\" alt=\"upload\" />\r\n            </div>\r\n            <div className=\"d-flex w-100 flex-column flex-md-row align-items-md-center\">\r\n                <h4 className=\"text-dark my-0 mr-3 text-break text-muted\">\r\n                    {props.name}\r\n                </h4>\r\n                <div className=\"progress flex-grow-1 mr-2\" style={{height: \"22px\"}}>\r\n                    <div className=\"progress-bar progress-bar-striped progress-bar-animated\" \r\n                        style={{width: props.progress+\"%\"}}>\r\n                        {Math.round(props.progress) + \"%\"}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <button type=\"button\" \r\n                className=\"close mr-2\" \r\n                onClick={props.callback} \r\n                id={props.index}>\r\n                    &times;\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction FileQueued(props) {\r\n    return (\r\n        <div className=\"d-flex w-100\">\r\n            <div className=\"align-self-center mx-3\">\r\n                <img src=\"img/cloud-upload-light.svg\" height=\"50\" alt=\"upload\" />\r\n            </div>\r\n            <div className=\"d-flex w-100 flex-column flex-md-row align-items-md-center\">\r\n                <h4 className=\"text-dark my-0 mr-3 text-break text-muted\">\r\n                    {props.name}\r\n                </h4>\r\n                <small className=\"flex-grow-1 mr-2 text-secondary\">\r\n                    В очереди на загрузку\r\n                </small>\r\n            </div>\r\n            <button type=\"button\" \r\n                className=\"close mr-2\" \r\n                onClick={props.callback} \r\n                id={props.index}>\r\n                    &times;\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nfunction FileError(props) {\r\n    return (\r\n        <div className=\"d-flex w-100\">\r\n            <div className=\"align-self-center mx-3\">\r\n                <img src=\"img/error.svg\" height=\"50\" alt=\"upload\" />\r\n            </div>\r\n            <div className=\"d-flex w-100 flex-column flex-md-row align-items-md-center\">\r\n                <h4 className=\"text-dark my-0 mr-3 text-break text-muted\">\r\n                    {props.name}\r\n                </h4>\r\n                <small className=\"flex-grow-1 mr-2 text-secondary\">\r\n                    {props.error_text}\r\n                </small>\r\n            </div>\r\n            <button type=\"button\" \r\n                className=\"close mr-2\" \r\n                onClick={props.callback} \r\n                id={props.index}>\r\n                    &times;\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nfunction FileNormal(props) {\r\n    return (\r\n        <div className=\"d-flex w-100\">\r\n            <a download href={API.fileDownloadURL(props.id, props.token)} className=\"align-self-center mx-3\">\r\n                <img src=\"img/cloud-download.svg\" height=\"50\" alt=\"download\" />\r\n            </a>\r\n            <div className=\"d-flex w-100 flex-column flex-md-row align-items-md-center\">\r\n                <a download ref={props.saveRef} href={API.fileDownloadURL(props.id, props.token)} className=\"flex-grow-1 text-dark\">\r\n                    <h4 className=\"my-0 mr-2 text-break\">\r\n                        {props.name}\r\n                    </h4>\r\n                </a>\r\n                <div className=\"d-flex flex-column flex-md-row\">\r\n                    <small className=\"mx-md-2 mx-0 text-body text-break\">\r\n                        { filesize(props.size) }\r\n                    </small> \r\n                    <small className=\"mx-md-2 mx-0 text-secondary text-break\">\r\n                        <TimeAgo date={props.uploaded} formatter={formatter} />\r\n                    </small> \r\n                    <small className=\"mr-md-2 mx-0 text-secondary text-break\">\r\n                        {props.user}\r\n                    </small>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default function File(props) {\r\n    let file;\r\n    if (props.queued)\r\n        file = FileQueued(props);\r\n    else if (props.uploading)\r\n        file = FileUploading(props);\r\n    else if (props.error)\r\n        file = FileError(props);\r\n    else\r\n        file = FileNormal(props);\r\n    return (\r\n    <div key={props.index} className=\"list-group-item p-1\">\r\n        {file}\r\n    </div>);\r\n}\r\n","function Seconds(x) {\r\n    const last_digit = x %  10;\r\n\r\n    // 11,12,13,14 - исключения\r\n    if ( x>10 && x < 15 )\r\n        return x + ' секунд';\r\n\r\n    switch(last_digit){\r\n        case 1:\r\n            return x + ' секунда';\r\n        case 2:\r\n        case 3:\r\n        case 4:\r\n            return x + ' секунды';\r\n        default:\r\n            return x + ' секунд';\r\n    }\r\n}\r\n\r\nfunction Minutes(x) {\r\n    const last_digit = x %  10;\r\n\r\n    // 11,12,13,14 - исключения\r\n    if ( x>10 && x < 15 )\r\n        return x + ' минут';\r\n\r\n    switch(last_digit){\r\n        case 1:\r\n            return x + ' минута';\r\n        case 2:\r\n        case 3:\r\n        case 4:\r\n            return x + ' минуты';\r\n        default:\r\n            return x + ' минут';\r\n    }\r\n}\r\n\r\nexport default function TimeLeft(mseq) {\r\n    const fsecs  = mseq / 1000;\r\n    const fhours = fsecs / 3600;\r\n    const fmins  = fsecs / 60;\r\n    \r\n    const hours  = Math.floor(fhours);\r\n    const mins   = Math.floor(fmins) % 60;\r\n    const secs   = Math.floor(fsecs) % 60;\r\n\r\n    if (fhours >= 5)\r\n        return (hours + \" часов\"); // следующий падеж - 21 час, не поддерживаем пока\r\n    else if (fhours >= 2)\r\n        return (hours + \" часа \" + Minutes(mins));\r\n    else if (fhours >= 1)\r\n        return (\"1 час \" + Minutes(mins));\r\n    else if (mins >= 3)\r\n        return Minutes(mins);\r\n    else if (mins >= 1)\r\n        return (Minutes(mins) + ' ' + Seconds(secs));\r\n    else\r\n        return (Seconds(secs));\r\n\r\n}\r\n\r\n/*\r\nfunction test (h,m,s,ms){\r\n    let output = h+':'+m+':'+s+'('+ms+') ' \r\n        + TimeLeft(ms+1000*(s+60*(m+60*h)));\r\n    console.log(output);\r\n}\r\n\r\ntest(10,45,5,123);\r\ntest(4,45,5,123);\r\ntest(3,45,5,123);\r\ntest(2,45,5,123);\r\ntest(1,45,5,123);\r\ntest(0,45,5,123);\r\ntest(0,43,5,123);\r\ntest(0,41,5,123);\r\ntest(0,11,5,123);\r\ntest(0,3,0,123);\r\ntest(0,2,1,123);\r\ntest(0,2,2,123);\r\ntest(0,2,3,123);\r\ntest(0,2,5,123);\r\ntest(0,1,5,123);\r\ntest(0,0,5,123);\r\ntest(0,0,3,123);\r\ntest(0,0,1,123);\r\ntest(0,0,0,0);\r\n*/\r\n\r\n","import React         from 'react';\r\nimport filesize      from 'filesize';\r\nimport TimeLeft      from './TimeLeft';\r\nimport API           from './server_api'\r\n\r\n\r\n\r\nexport default function FolderStats(props) {\r\n    let progress = props.stats.uploaded_so_far;\r\n\r\n    // прогресс с учетом файлов, которые еще загружаются\r\n    for (let i in props.stats.files) {\r\n        const f = props.stats.files[i];\r\n        if (f.uploading) {\r\n            progress += f.size * f.progress / 100;\r\n        }\r\n    }\r\n\r\n    let percentage = 0, elapsed = 0, time_left = 0;\r\n    if (props.stats.uploading_now) {\r\n        // оставшийся процент\r\n        percentage = (100 * (props.stats.total_to_upload - progress) / props.stats.total_to_upload).toFixed(1);\r\n        // оставшееся время (в миллисекундах)\r\n        elapsed = (new Date()).getTime() - props.stats.upload_started.getTime();\r\n        time_left = elapsed / progress * (props.stats.total_to_upload - progress + 1);\r\n    }\r\n\r\n    const downloadAll = function (event){\r\n        event.preventDefault();\r\n        console.log(props.linkrefs);\r\n        for (let i in props.linkrefs)\r\n            setTimeout((ref)=>{ref.click()}, i*300, props.linkrefs[i]);\r\n    }\r\n    \r\n    return (<div className=\"d-flex flex-wrap w-100 justify-content-left my-2\">\r\n        \r\n        <small className=\"mr-3 flex-grow-1\">\r\n            { props.stats.files.length > 0 && props.stats.files.length < 6 && !props.stats.uploading_now && \r\n                <a download href=\"/#\" onClick={downloadAll}>\r\n                    Скачать по одному »\r\n                </a>\r\n            }\r\n            { props.stats.files.length > 3 && !props.stats.uploading_now && \r\n                <a download href={API.fileDownloadURL(props.stats.id, props.stats.zip_token)}>\r\n                    Скачать все (zip) »\r\n                </a>\r\n            }\r\n        </small>\r\n        <div className=\"mx-1 text-body\">\r\n            {props.stats.uploading_now ?\r\n                <small>\r\n                    <span className=\"text-secondary\"> Загружаем </span>\r\n                    {filesize(props.stats.total_to_upload)}\r\n                    <span className=\"text-secondary\">, осталось </span>\r\n                    {percentage + '%, '}\r\n                    {TimeLeft(time_left)}\r\n                </small> :\r\n                <small>\r\n                    {props.stats.files.length}\r\n                    <span className=\"text-secondary\"> файла(ов), </span>\r\n                    {filesize(props.stats.total_uploaded)}\r\n                </small>}\r\n        </div>\r\n    </div>);\r\n}\r\n","import React     from 'react';\r\nimport { Link }  from \"react-router-dom\";\r\n\r\nexport default function Breadcrumbs(props) {\r\n    return (<nav aria-label=\"breadcrumb\">\r\n        <ol className=\"breadcrumb mb-2\">\r\n            <li className=\"breadcrumb-item\"><Link to=\"/\">Все проекты</Link></li>\r\n            { props.parent_id !== undefined &&\r\n                <li className=\"breadcrumb-item\"><Link to={\"/project/\" + props.parent_id}>{props.parent_name}</Link></li>\r\n            }\r\n            <li className=\"breadcrumb-item active\" aria-current=\"page\">{props.name}</li>\r\n        </ol>\r\n    </nav>);\r\n}\r\n","import React, { Component } from 'react';\r\nimport { Redirect }         from \"react-router-dom\";\r\nimport Navbar               from './Navbar';\r\nimport FileDropzone         from './FileDropzone';\r\nimport File                 from './File';\r\nimport API                  from './server_api'\r\nimport FolderStats          from './FolderStats';\r\nimport Breadcrumbs          from './Breadcrumbs';\r\nimport { isAuthenticated }  from './Login'\r\n\r\n\r\n\r\nexport default class Folder extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            name:            null,\r\n            id:              this.props.match.params.id,\r\n            zip_token:       null,\r\n            parent_id:       null,\r\n            files:           [],\r\n            uploading_now:   false,\r\n            upload_started:  null,\r\n            uploaded_so_far: 0,\r\n            total_to_upload: 0,\r\n            total_uploaded:  0,\r\n         };\r\n\r\n        this.onFilesAdded     = this.onFilesAdded.bind(this);\r\n        this.onCancelFile     = this.onCancelFile.bind(this);\r\n        this.onFileUpoaded    = this.onFileUpoaded.bind(this);\r\n        this.onUploadProgress = this.onUploadProgress.bind(this);\r\n        this.onUploadError    = this.onUploadError.bind(this);\r\n        this.onFileListLoaded = this.onFileListLoaded.bind(this);\r\n    }\r\n\r\n    componentWillMount() {\r\n        if ( isAuthenticated() )\r\n            API.getFolder( this.onFileListLoaded, this.props.match.params.id );\r\n    }\r\n\r\n    onFileListLoaded(json){\r\n        let size=0;\r\n        for (let i in json.files)\r\n            size += json.files[i].size;\r\n        this.setState({\r\n            name:        json.name,\r\n            parent_id:   json.parent_id,\r\n            parent_name: json.parent_name,\r\n            files:       json.files,\r\n            zip_token:   json.zip_token,\r\n            total_uploaded: size,\r\n        });\r\n    }\r\n\r\n    onFilesAdded(files){\r\n        const new_files=[];\r\n        let added_size=0;\r\n        // Добавляем новые файлы в очередь на закачку\r\n        for (let i in files) {\r\n            // не позволяем заливать дубликаты\r\n            let duplicate = false;\r\n            for (let j in this.state.files){\r\n                if ( this.state.files[j].error !== true &&  this.state.files[j].name === files[i].name ) {\r\n                    duplicate = true;\r\n                    new_files.push({ name: files[i].name, error: true, error_text: \"Файл с таким именем уже есть в этой папке.\" });\r\n                    break;\r\n                }\r\n            }\r\n            // ставим в очередь на закачку\r\n            if ( duplicate === false ){\r\n                const file = { \r\n                    name: files[i].name,\r\n                    size: files[i].size,\r\n                    file: files[i],\r\n                    queued: true, \r\n                };\r\n                new_files.push(file);\r\n                added_size += files[i].size;\r\n            }\r\n        }\r\n        // асинхронно добавляем их к состоянию\r\n        this.setState( old_state => ({\r\n            files: old_state.files.concat(new_files),\r\n            total_to_upload: old_state.total_to_upload+added_size,\r\n        }));\r\n        // запускаем закачку следующих по очереди\r\n        this.rollQueue();\r\n    }\r\n\r\n    rollQueue(){\r\n        // делаем обновление асинхронно\r\n        if ( isAuthenticated() ) // нужно регулярно вызывать этот метод, чтобы обнолять устаревающие токены\r\n            this.setState( old_state => {\r\n\r\n            const files = old_state.files;\r\n            // считаем количество текущих закачек\r\n            let uploads = 0;\r\n            for (let i in files)\r\n                if ( files[i].uploading )\r\n                    uploads++;\r\n\r\n            // запускаем новые, если нужно\r\n            while (uploads < 3){\r\n                // ищем следующую в очереди\r\n                let next = null;\r\n                for(let i in files){\r\n                    if ( files[i].queued ){\r\n                        next = i;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                // выходим, если очередь закончилась\r\n                if (next === null)\r\n                    break;\r\n\r\n                // запускаем реальную загрузку\r\n                const ref = API.uploadFile(this.props.match.params.id, files[next].file, this.onUploadProgress, this.onFileUpoaded, this.onUploadError);\r\n\r\n                // добавляем в табличку новую загрузку\r\n                files[next] = { \r\n                    name: files[next].name,\r\n                    size: files[next].size,\r\n                    uploading: true, \r\n                    progress: 0,\r\n                    ref,\r\n                };\r\n                uploads++;\r\n            }\r\n            \r\n            // если это самое начало - инициализируем статистику\r\n            if ( (!old_state.uploading_now) && uploads > 0 ){\r\n                // считаем полный объем данных для закачки\r\n                let to_upload = 0;\r\n                for (let i in files)\r\n                    if ( files[i].uploading || files[i].queued )\r\n                        to_upload += files[i].size;\r\n\r\n                // обвноляем состояние и статистику\r\n                return { \r\n                    files: files,\r\n                    uploading_now: true,\r\n                    upload_started: new Date(),\r\n                    total_to_upload: to_upload,\r\n                    uploaded_so_far: 0\r\n                };\r\n            }\r\n\r\n            // просто обновляем состояние\r\n            return { \r\n                files: files,\r\n                uploading_now: (uploads > 0),\r\n            };\r\n        });\r\n    }\r\n\r\n    onCancelFile(event){\r\n        event.preventDefault();\r\n        const index = event.target.id;\r\n        // обрываем закачку\r\n        if ( this.state.files[index].uploading )\r\n            this.state.files[index].ref.abort();\r\n        // асинхронно удаляем из состояния\r\n        this.setState( old_state =>{\r\n            const new_files = old_state.files;\r\n            const size = new_files[index].size;\r\n            new_files.splice(index, 1);\r\n            return { \r\n                files: new_files,\r\n                total_to_upload: old_state.total_to_upload - size,\r\n            };\r\n        });\r\n        // запускаем закачку следующих по очереди\r\n        this.rollQueue();\r\n    }\r\n\r\n    // Обновляем состояние при окончании загрузки файла\r\n    onFileUpoaded(name, json){\r\n        this.setState( old_state => {\r\n            const copy = old_state.files;\r\n            let size=0;\r\n            for (let i in copy){\r\n                const file =  copy[i];\r\n                if ( file.uploading && file.name === name ){\r\n                    if ( json.error !== undefined ){\r\n                        copy[i] = { name, error: true, error_text: json.error };\r\n                    }\r\n                    else {\r\n                        copy[i] = json; \r\n                    }\r\n                    size += file.size;\r\n                    break;\r\n                }\r\n            }\r\n            return ({ \r\n                files:           copy,\r\n                uploaded_so_far: old_state.uploaded_so_far+size,\r\n                total_uploaded:  old_state.total_uploaded+size,\r\n            });\r\n        });\r\n        // запускаем закачку следующих по очереди\r\n        this.rollQueue();\r\n    }\r\n\r\n    // Обновляем прогресс загрузки файла\r\n    onUploadProgress(name, progress){\r\n        this.setState( old_state => {\r\n            const copy = old_state.files;\r\n            for (let i in copy){\r\n                const file =  copy[i];\r\n                if ( file.uploading && file.name === name )\r\n                    copy[i].progress = progress;\r\n            }\r\n            return ( { files: copy });\r\n        });\r\n    }\r\n\r\n    // Ошибка загрузки,обновляем статус\r\n    onUploadError(name, text){\r\n        this.setState( old_state => {\r\n            const copy = old_state.files;\r\n            for (let i in copy){\r\n                const file =  copy[i];\r\n                if ( file.uploading && file.name === name )\r\n                    copy[i] =  { name, error: true, error_text: text }\r\n            }\r\n            return ( { files: copy });\r\n        });\r\n    }\r\n\r\n    render () {\r\n        // неавторизованных пользователей перенаправляем на страницу логина\r\n        if ( !isAuthenticated() )\r\n            return (<Redirect to={{ pathname: \"/login\", state: { from: this.props.location }}} />);\r\n\r\n        // указатели на ссылки для скачивания\r\n        let linkrefs=[];\r\n        let saveRef = function (ref) { linkrefs.push(ref); }\r\n\r\n        // готовим массив файлов - оснащаем коллбеками\r\n        const files = [];\r\n        for(let i in this.state.files ){\r\n            let file = this.state.files[i];\r\n            file.index = i;\r\n            file.callback = this.onCancelFile;\r\n            file.saveRef = saveRef;\r\n            files.push(File(file));\r\n        }\r\n\r\n        return ([\r\n            <Navbar key='navbar' />,\r\n            <Breadcrumbs key='breadcrumbs' \r\n                parent_id = {this.state.parent_id}\r\n                parent_name = {this.state.parent_name}\r\n                name = {this.state.name}/>,\r\n            <main key='body' role=\"main\" className=\"container\">\r\n                <FolderStats stats={this.state} linkrefs={linkrefs} />\r\n                <FileDropzone onFilesAdded={this.onFilesAdded}>\r\n                    <div className=\"list-group shadow\">\r\n                        {files}\r\n                    </div>\r\n                </FileDropzone>\r\n            </main>\r\n        ]);\r\n    }\r\n}\r\n","import React, { Component } from 'react';\r\nimport { Redirect }         from \"react-router-dom\";\r\nimport Navbar               from './Navbar';\r\nimport { isAuthenticated }  from './Login'\r\nimport Avatar               from './Avatar';\r\nimport API                  from './server_api'\r\nimport { getMe, updateMe }  from './Login';\r\n\r\nimport TimeAgo              from 'react-timeago';\r\nimport ruStrings            from 'react-timeago/lib/language-strings/ru'\r\nimport buildFormatter       from 'react-timeago/lib/formatters/buildFormatter'\r\n\r\n\r\nconst formatter = buildFormatter(ruStrings);\r\n\r\n\r\nfunction UserDescription (props) {\r\n    const p = props.state;\r\n    const editing = p.editing;\r\n\r\n    // красивый список проектов пользователя\r\n    let projs = [];\r\n    if (p.project_names !== undefined){\r\n        for (let i in p.project_names){\r\n            projs.push(<strong key={i}>{p.project_names[i]}</strong>);\r\n            if ( i < p.project_names.length-1 )\r\n                projs.push(', ');\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"border shadow-lg rounded-lg bg-white mt-4 p-4\">\r\n            <div className='d-flex'>\r\n                { p.is_loaded && <Avatar email={p.email} size='120' className='pr-4' /> }\r\n                <div className='flex-fill'>\r\n                    { editing !== 'name' &&\r\n                        <span className='d-flex justify-content-between'>\r\n                            <h1 className=\"display-4 text-break\">{p.name}</h1>\r\n                            <button className='close' disabled={ p.is_deleting || !p.is_loaded }>\r\n                                <img src='img/edit.svg' \r\n                                    className='align-self-start mt-0 ml-sm-5' \r\n                                    onClick={ p.is_deleting ? ()=>{} : props.clb.onEditNameButton } \r\n                                    alt='edit'/>\r\n                            </button>\r\n                        </span>\r\n                    }\r\n                    { editing === 'name' && \r\n                        <form className=\"form-inline mb-4\" onSubmit={ props.clb.onNameChangeButton } autoComplete=\"off\">\r\n                            <div className=\"form-group flex-grow-1\">\r\n                                <input type=\"text\" \r\n                                    className=\"form-control w-100 mr-2\"\r\n                                    id=\"nameEdit\" \r\n                                    maxLength='50'\r\n                                    autoFocus={true} \r\n                                    onChange={props.clb.handleInputChange}\r\n                                    value={ p.nameEdit }/>\r\n                            </div>\r\n                            <div>\r\n                                <button type=\"reset\" className=\"btn btn-secondary mr-2\" onClick={ props.clb.onCancelButton }>Отмена</button>\r\n                                <button type=\"submit\" className=\"btn btn-primary\">Изменить</button>\r\n                            </div>\r\n                        </form>\r\n                    }\r\n                    <span className='d-flex justify-content-between'>\r\n                        <p className=\"lead text-break\">{p.email}</p>\r\n                    </span>\r\n                </div>\r\n            </div>\r\n            <hr className=\"my-4\"/>\r\n            { p.is_loaded && p.is_admin &&\r\n                <div>\r\n                    <p>Администратор сервиса. Имеет доступ к:</p>\r\n                    <ul>\r\n                        <li>Созданию и удалению проектов</li>\r\n                        <li>Добавлению и удалению внешних пользователей</li>\r\n                        <li>Управлению доступом внешних пользователей к проектам</li>\r\n                        <li>Созданию новых папок в проектах</li>\r\n                        <li>Скачиванию файлов из папок проекта</li>\r\n                        <li>Загрузке новых файлов в папки</li>\r\n                    </ul>\r\n                </div>\r\n            }\r\n            { p.is_loaded && !p.is_admin &&\r\n                <div>\r\n                    <p>Пользователь сервиса. Имеет доступ к:</p>\r\n                    <ul>\r\n                        <li>Созданию новых папок в проектах</li>\r\n                        <li>Скачиванию файлов из папок проекта</li>\r\n                        <li>Загрузке новых вайлов в папки</li>\r\n                    </ul>\r\n                    { projs.length >0 && <p>Является участником следующих проектов: {projs}.</p> }\r\n                    { projs.length === 0 && <p>В данный момент не участвует ни в одном из проектов.</p> }\r\n                </div>\r\n            }\r\n            { !p.is_loaded || !getMe().is_admin || getMe().id === p.id ||\r\n                <button className=\"btn btn-danger btn-lg mt-3\" \r\n                disabled={ p.is_deleting } \r\n                onClick={ props.clb.onDeleteUser } >\r\n                    Удалить пользователя\r\n                </button>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nfunction ServerStatus (props) {\r\n\r\n    // идет перезагрузка?\r\n    if (typeof props.state === 'string')\r\n    return (\r\n        <div className=\"border  shadow-lg rounded-lg bg-white mt-4 p-4\">\r\n            <h1>Идет обновление сервера...</h1>\r\n        </div>\r\n    );\r\n\r\n\r\n\r\n    // сторим список обновлений с момента запуска текуще версии\r\n    let updates = [];\r\n    for (let i in props.state.updates)\r\n        updates.push(<li>(<strong>{props.state.updates[i].hash}</strong>) <i>'{props.state.updates[i].name}'</i></li>);\r\n\r\n    return (\r\n        <div className=\"border  shadow-lg rounded-lg bg-white mt-4 p-4\">\r\n            <h1>Статистика сервера</h1>\r\n            <p>\r\n                Стартовал <TimeAgo date={new Date(props.state.uptime_starts)} formatter={formatter} />.<br/>\r\n                Текущая ревизия: (<strong>{props.state.current_hash}</strong>) <i>'{props.state.current_name}'</i>\r\n                , закомичена <TimeAgo date={new Date(props.state.current_date)} formatter={formatter} />.<br/>\r\n                { props.state.updates.length === 0 &&\r\n                    <span>Доступных обновлений нет.</span>\r\n                }\r\n            </p>\r\n            { props.state.updates.length > 0 && <div>\r\n                <h3>Доступны обновления:</h3>\r\n                <ul> {updates} </ul>\r\n                <button className=\"btn btn-danger btn-lg mt-3\"\r\n                    onClick={ props.clb } >\r\n                        Обновить\r\n                </button>\r\n            </div> }\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n\r\nexport default class User extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            is_loaded:   false,\r\n            editing:     'none',\r\n            name:        '',\r\n            email:       '',\r\n            is_deleting:  false,     // отослан запрос на удаление пользователя\r\n            is_deleted:   false,     // пришел ответ, что пользователь удален\r\n            me:           getMe(),\r\n            version_info: null,      // информация о версии серверного приложения\r\n        };\r\n\r\n        // способ отслеживания изменения URI и загрузи правильных данных\r\n        this.cached_id = this.props.match.params.id;\r\n\r\n        this.handleInputChange     = this.handleInputChange.bind(this);\r\n        this.onEditNameButton      = this.onEditNameButton.bind(this);\r\n        this.onNameChangeButton    = this.onNameChangeButton.bind(this);\r\n        this.onCancelButton        = this.onCancelButton.bind(this);\r\n        this.onDeleteUser          = this.onDeleteUser.bind(this);\r\n        this.onUpdateServer        = this.onUpdateServer.bind(this);\r\n    }\r\n\r\n    loadUserInfo(){\r\n        // загружаем информацию о пользователе\r\n        API.getUser( (json)=>{ \r\n            json.is_loaded = true; // информация наконец загружена\r\n            this.setState( json ); \r\n            // загружаем информацию о версии сервера, если это страница админа\r\n            if ( this.state.me.is_admin && this.state.me.email === json.email )\r\n                API.getVersion( (json2) => this.setState( { version_info: json2 }) );\r\n        }, this.props.match.params.id );\r\n    }\r\n\r\n    componentWillMount() {\r\n        if ( isAuthenticated() )\r\n            this.loadUserInfo();\r\n    }\r\n\r\n    componentDidUpdate(){\r\n        // отслеживаем изменение ссылки, чтобы перезагрузить информацию о пользователе\r\n        if ( this.cached_id !== this.props.match.params.id ){\r\n            this.cached_id = this.props.match.params.id;\r\n            this.setState({ is_loaded: false })\r\n            this.loadUserInfo();\r\n        }\r\n    }\r\n\r\n    handleInputChange(event) {\r\n        const target = event.target;\r\n        this.setState({ [target.id]: target.value });\r\n    }\r\n\r\n    onEditNameButton (event) {\r\n        this.setState( { editing: 'name', nameEdit: this.state.name });\r\n    }\r\n\r\n    onNameChangeButton (event) {\r\n        this.setState({ editing: 'none' });\r\n        API.updateUserName( ()=>{ \r\n            // если редактируем себя - обновляем\r\n            if ( getMe().id === this.props.match.params.id ) {\r\n                let json = getMe();\r\n                json.name = this.state.nameEdit;\r\n                updateMe(json);\r\n            }\r\n            this.setState({name: this.state.nameEdit, me: getMe()}); \r\n        }, this.props.match.params.id, this.state.nameEdit );\r\n        event.preventDefault();\r\n    }\r\n\r\n    onCancelButton (event) {\r\n        this.setState( { editing: 'none' });\r\n    }\r\n\r\n    onDeleteUser (event) {\r\n        this.setState( { editing: 'none', is_deleting: true });\r\n        API.deleteUser(()=>{ this.setState( { is_deleted: true }); }, this.props.match.params.id);\r\n        event.preventDefault();\r\n    }\r\n\r\n    onUpdateServer (event) {\r\n        API.updateServer(()=>{\r\n            // отрисовываем статус обновления сервера\r\n            this.setState({ version_info: 'updating'});\r\n            setTimeout( ()=>{\r\n                // после обновления снова рисуем информацию о версии\r\n                API.getVersion( (json2) => this.setState( { version_info: json2 }) );\r\n            }, 15000);\r\n        });\r\n    }\r\n\r\n    render () {\r\n        // неавторизованных пользователей перенаправляем на страницу логина\r\n        if ( !isAuthenticated() )\r\n            return (<Redirect to={{ pathname: \"/login\", state: { from: this.props.location }}} />);\r\n\r\n        // после удаление проекта переходим к списку проектов снова\r\n        if ( this.state.is_deleted )\r\n            return (<Redirect to='/' />);\r\n        \r\n        return ([\r\n            <Navbar key='navbar' me={this.state.me} />,\r\n            <main key='body' role=\"main\" className=\"container\">\r\n                <UserDescription state= {this.state} clb={this} />\r\n                { this.state.version_info &&\r\n                    <ServerStatus state= {this.state.version_info} clb={this.onUpdateServer} /> \r\n                }\r\n            </main>\r\n        ]);\r\n    }\r\n}\r\n","import React, { Component } from 'react';\r\nimport { Redirect }         from \"react-router-dom\";\r\nimport Navbar               from './Navbar';\r\nimport { isAuthenticated }  from './Login'\r\nimport API                  from './server_api'\r\n\r\n\r\nexport default class NewProject extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            name:           '',\r\n            description:    '',\r\n            processing:     false,  // уже отправили запрос на сервер\r\n            processed:      false,  // уже получили ответ сервере\r\n            id:             '',     // id нового проекта\r\n        };\r\n\r\n        this.handleInputChange     = this.handleInputChange.bind(this);\r\n        this.onCreate              = this.onCreate.bind(this);\r\n        this.onCreated             = this.onCreated.bind(this);\r\n    }\r\n\r\n    handleInputChange(event) {\r\n        const target = event.target;\r\n        this.setState({ [target.id]: target.value });\r\n    }\r\n\r\n    onCreate(event){\r\n        API.addProject(this.onCreated, this.state.name, this.state.description );\r\n        this.setState({ processing: true });\r\n        event.preventDefault();\r\n    }\r\n\r\n    onCreated(json) {\r\n        this.setState({ processed: true, id: json.id });\r\n    }\r\n\r\n    render() {\r\n        // неавторизованных пользователей перенаправляем на страницу логина\r\n        if ( !isAuthenticated() )\r\n            return (<Redirect to={{ pathname: \"/login\", state: { from: this.props.location }}} />);\r\n\r\n        // после получения ответа от сервера отправляем на сраницу настроек нового проекта\r\n        if ( this.state.processed )\r\n            return (<Redirect to={ '/project/'+this.state.id } />);\r\n\r\n        return ([\r\n            <Navbar key='navbar' />,\r\n            <main key='body' role=\"main\" className=\"container\">\r\n                <form onSubmit={this.onCreate} autoComplete=\"off\">\r\n                    <fieldset disabled={this.state.processing}>\r\n                        <h2 className='mt-3'>Создать новый проект</h2>\r\n                        <div className=\"form-group\">\r\n                            <input type=\"text\" \r\n                                className=\"form-control\"\r\n                                id=\"name\" \r\n                                placeholder=\"Введите название\" \r\n                                onChange={this.handleInputChange}\r\n                                value={this.state.name}\r\n                                required />\r\n                        </div>\r\n                        <div className=\"form-group\">\r\n                            <textarea className=\"form-control\"\r\n                                id=\"description\" \r\n                                rows=\"3\" \r\n                                placeholder=\"Описание проекта (не обязательно)\" \r\n                                onChange={this.handleInputChange}\r\n                                value={this.state.description} />\r\n                        </div>\r\n                        <button type=\"submit\" className=\"btn btn-primary\">Создать</button>\r\n                    </fieldset>\r\n                </form>\r\n            </main>\r\n        ]);\r\n    }\r\n}\r\n","import React, { Component } from 'react';\r\nimport { Redirect, Link }   from \"react-router-dom\";\r\nimport Navbar               from './Navbar';\r\nimport { isAuthenticated }  from './Login'\r\nimport Breadcrumbs          from './Breadcrumbs';\r\nimport Avatar               from './Avatar';\r\nimport API                  from './server_api'\r\nimport { getMe }            from './Login';\r\n\r\nimport TimeAgo              from 'react-timeago';\r\nimport ruStrings            from 'react-timeago/lib/language-strings/ru'\r\nimport buildFormatter       from 'react-timeago/lib/formatters/buildFormatter'\r\n\r\nimport './Project.css'\r\n\r\nconst formatter = buildFormatter(ruStrings);\r\n\r\n// это так же используется в server/routes/isEmailValid.js\r\n// если вносятся правки тут, то надо не забыть обновить и там\r\nfunction emailIsValid (email) {\r\n    if (email === undefined)\r\n        return false;\r\n    //const e = sanitizeHtml(email.trim());\r\n    const e = email.trim();\r\n    if (e.length > 50)\r\n        return false;\r\n    const regexp = /\\S+@\\S+\\.((?:com)|(?:ru))/;\r\n    const m = e.match(regexp);\r\n    //  есть совпадение и оно полное\r\n    return (m !== null && m[0] === e);    \r\n}\r\n\r\nfunction User (props) {\r\n    const icon = (props.icon==='add') ? 'img/add-user.svg' : 'img/delete-user.svg';\r\n    const animated = props.animated ? \"user-animated\" : \"\";\r\n    return (\r\n        <li className={\"list-group-item d-flex align-items-center \"+ animated} >\r\n            <Avatar email={props.user.email} size='80' />\r\n            <div className='flex-grow-1 text-break ml-3'>\r\n                <Link to={'/user/' + props.user.id} className='text-dark'>\r\n                    <h5>{props.user.name}</h5>\r\n                    <span>{props.user.email}</span>\r\n                </Link>\r\n            </div>\r\n            <button className='close' id={props.user.id} onClick={props.func}>\r\n                <img src={icon} id={props.user.id} height=\"50px\" className='ml-2' alt='move user'/>\r\n            </button>\r\n        </li>\r\n    );\r\n}\r\n\r\nfunction NewUser (props) {\r\n    const editing = props.state.editing;\r\n    // валидируем введенный емейл\r\n    const email_valid = emailIsValid(props.state.user_email);\r\n    return (\r\n        <li className=\"list-group-item d-flex align-items-center justify-content-center\">\r\n            { editing === 'user' ||\r\n                <button className='close'>\r\n                    <img src='img/add-new-user.svg' \r\n                    onClick={ props.onNewUserButton } \r\n                    height=\"50px\"\r\n                    alt='edit'/>\r\n                </button>\r\n            }\r\n            { editing === 'user' &&\r\n                <form className=\"form-inline\" onSubmit={ props.onCreateUserButton } autoComplete=\"off\">\r\n                    <div className=\"form-row w-100\">\r\n                        <div className=\"input-group mb-2 col-sm-6\">\r\n                            <input type=\"text\" \r\n                                className=\"form-control\" \r\n                                id=\"user_name\" \r\n                                placeholder=\"Имя\" \r\n                                maxLength='50'\r\n                                onChange={props.handleInputChange}\r\n                                value={props.state.user_name}\r\n                                required/>\r\n                        </div>\r\n                        <div className=\"input-group mb-2 col-sm-6\">\r\n                            <div className=\"input-group-prepend\">\r\n                                <div className=\"input-group-text\">@</div>\r\n                            </div>\r\n                            <input type=\"email\" \r\n                                className={\"form-control \" + (email_valid ? \"is-valid\" :\"is-invalid\")}\r\n                                id=\"user_email\" \r\n                                placeholder=\"Email\"\r\n                                maxLength='50'\r\n                                onChange={props.handleInputChange}\r\n                                value={props.state.user_email}\r\n                                required />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"form-row px-1\">\r\n                        <button type=\"reset\" className=\"btn btn-secondary mr-2\" onClick={ props.onCancelButton }>Отмена</button>\r\n                        <button type=\"submit\" className={\"btn btn-primary\" + ( email_valid?\"\":\" disabled\")}>\r\n                            Создать\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            }\r\n        </li>\r\n    )\r\n}\r\n\r\nfunction ProjectDescription (props) {\r\n    const editing = props.state.editing;\r\n    return (\r\n        <div className=\"border border-light shadow-lg rounded-lg bg-white mt-4 p-4\">\r\n            { editing !== 'name' &&\r\n                <span className='d-flex justify-content-between'>\r\n                    <h1 className=\"display-4 text-break\">{props.state.name}</h1>\r\n                    { !getMe().is_admin ||  props.state.folders_num > 0 ||\r\n                        <button className='close' disabled={ props.state.is_deleting || !props.state.is_loaded }>\r\n                            <img src='img/edit.svg' \r\n                                className='align-self-start mt-4 ml-3' \r\n                                onClick={ props.state.is_deleting ? ()=>{} : props.clb.onEditNameButton } \r\n                                alt='edit'/>\r\n                        </button>\r\n                    }\r\n                </span>\r\n            }\r\n            { editing === 'name' && \r\n                <form className=\"form-inline mb-4\" onSubmit={ props.clb.onNameChangeButton } autoComplete=\"off\">\r\n                    <div className=\"form-group flex-grow-1\">\r\n                        <input type=\"text\" \r\n                            className=\"form-control w-100 mr-2\" \r\n                            id=\"nameEdit\" \r\n                            autoFocus={true} \r\n                            onChange={props.clb.handleInputChange}\r\n                            value={ props.state.nameEdit }/>\r\n                    </div>\r\n                    <div>\r\n                        <button type=\"reset\" className=\"btn btn-secondary mr-2\" onClick={ props.clb.onCancelButton }>Отмена</button>\r\n                        <button type=\"submit\" className=\"btn btn-primary\">Изменить</button>\r\n                    </div>\r\n                </form>\r\n            }\r\n            { editing !== 'description' &&                    \r\n                <span className='d-flex justify-content-between'>\r\n                    <p className=\"lead text-break\">{props.state.description}</p>\r\n                    { !getMe().is_admin ||\r\n                        <button className='close' disabled={ props.state.is_deleting || !props.state.is_loaded }>\r\n                            <img src='img/edit.svg' \r\n                                className='align-self-start mt-3 ml-3' \r\n                                onClick={ props.state.is_deleting ? ()=>{} : props.clb.onEditDescButton }  \r\n                                alt='edit'/>\r\n                        </button>\r\n                    }\r\n                </span>\r\n            }\r\n            { editing === 'description' && \r\n                <form className=\"form form mb-4\" onSubmit={ props.clb.onDescChangeButton } autoComplete=\"off\">\r\n                    <div className=\"form-group flex-grow-1 mr-sm-4\">\r\n                        <textarea className=\"form-control w-100\" \r\n                            id=\"descEdit\"\r\n                            rows=\"5\"\r\n                            autoFocus={true} \r\n                            onChange={props.clb.handleInputChange}\r\n                            value={props.state.descEdit}/>\r\n                    </div>\r\n                    <div>\r\n                        <button type=\"reset\" className=\"btn btn-secondary mr-2\" onClick={ props.clb.onCancelButton }>Отмена</button>\r\n                        <button type=\"submit\" className=\"btn btn-primary\">Изменить</button>\r\n                    </div>\r\n                </form>\r\n            }                    \r\n            <hr className=\"my-4\"/>\r\n            { !props.state.is_loaded ||\r\n                <p>Создан <strong><TimeAgo date={props.state.created} formatter={formatter}/></strong><br />\r\n                Содержит <strong>{props.state.folders_num} папки</strong>, <strong>{props.state.files_num} файла(ов)</strong>.</p>\r\n            }\r\n            { props.state.folders_num > 0 || !props.state.is_loaded || !getMe().is_admin ||\r\n                <button className=\"btn btn-danger btn-lg\" \r\n                disabled={ props.state.is_deleting } \r\n                onClick={ props.clb.onDeleteProject } >\r\n                    Удалить проект\r\n                </button>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n\r\nexport default class Project extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            is_loaded:   false,\r\n            editing:     'none',\r\n            name:        '',\r\n            description: '',\r\n            participants: new Set(), // id's of selected users\r\n            users:        [],        // все пользователи сервиса\r\n            moved_user:   '',        // id перемещенного пользвателся (для анимации)\r\n            is_deleting:  false,     // отослан запрос на удаление проекта\r\n            is_deleted:   false,     // пришел ответ, что проект удален\r\n        };\r\n\r\n        this.handleInputChange     = this.handleInputChange.bind(this);\r\n        this.onEditNameButton      = this.onEditNameButton.bind(this);\r\n        this.onNameChangeButton    = this.onNameChangeButton.bind(this);\r\n        this.onEditDescButton      = this.onEditDescButton.bind(this);\r\n        this.onDescChangeButton    = this.onDescChangeButton.bind(this);\r\n        this.onCancelButton        = this.onCancelButton.bind(this);\r\n        this.onAddUser             = this.onAddUser.bind(this);\r\n        this.onDeleteUser          = this.onDeleteUser.bind(this);\r\n        this.onNewUserButton       = this.onNewUserButton.bind(this);\r\n        this.onCreateUserButton    = this.onCreateUserButton.bind(this);\r\n        this.onProjectLoaded       = this.onProjectLoaded.bind(this);\r\n        this.onUserCreated         = this.onUserCreated.bind(this);\r\n        this.onDeleteProject       = this.onDeleteProject.bind(this);\r\n    }\r\n\r\n    onProjectLoaded(json) {\r\n        let newstate = json;\r\n        if ( 'users' in json ){\r\n            newstate.participants = new Set(json.users);\r\n            delete newstate.users;\r\n        }\r\n        newstate.is_loaded = true; // информация наконец загружена\r\n        this.setState( newstate );\r\n    }\r\n\r\n    componentWillMount() {\r\n        if ( isAuthenticated() ){\r\n            API.getProject( this.onProjectLoaded, this.props.match.params.id );\r\n            if ( getMe().is_admin )\r\n                API.getUsersList( (json) => { this.setState( { users: json }); } );\r\n        }\r\n    }\r\n\r\n    handleInputChange(event) {\r\n        const target = event.target;\r\n        this.setState({ [target.id]: target.value });\r\n    }\r\n\r\n    onEditNameButton (event) {\r\n        this.setState( { editing: 'name', nameEdit: this.state.name });\r\n    }\r\n\r\n    onNameChangeButton (event) {\r\n        API.updateProject(this.onProjectLoaded, this.props.match.params.id, this.state.nameEdit, this.state.description );\r\n        this.setState( { editing: 'none' });\r\n        event.preventDefault();\r\n    }\r\n\r\n    onEditDescButton (event) {\r\n        this.setState( { editing: 'description', descEdit: this.state.description });\r\n    }\r\n\r\n    onDescChangeButton (event) {\r\n        API.updateProject(this.onProjectLoaded, this.props.match.params.id, this.state.name, this.state.descEdit );\r\n        this.setState( { editing: 'none' });\r\n        event.preventDefault();\r\n    }\r\n\r\n    onNewUserButton (event) {\r\n        this.setState( { editing: 'user', user_name: '', user_email: '' });\r\n    }\r\n\r\n    onCancelButton (event) {\r\n        this.setState( { editing: 'none' });\r\n    }\r\n\r\n    onAddUser (event) {\r\n        let sel = this.state.participants;\r\n        sel.add(event.target.id);\r\n        API.updateUserProjects(()=>{}, event.target.id, this.props.match.params.id, 'add');\r\n        this.setState( { editing: 'none', participants: sel, moved_user: event.target.id });\r\n        event.preventDefault();\r\n    }\r\n\r\n    onDeleteUser (event) {\r\n        let sel = this.state.participants;\r\n        sel.delete(event.target.id);\r\n        API.updateUserProjects(()=>{}, event.target.id, this.props.match.params.id, 'delete');\r\n        this.setState( { editing: 'none', participants: sel, moved_user: event.target.id });\r\n        event.preventDefault();\r\n    }\r\n\r\n    onUserCreated (json) {\r\n        let new_users = this.state.users;\r\n        let sel = this.state.participants;\r\n\r\n        new_users.push(json);\r\n        sel.add(json.id);\r\n\r\n        this.setState( { \r\n            participants: sel,\r\n            users: new_users,\r\n            moved_user: json.id,\r\n            editing: 'none',\r\n        });\r\n    }\r\n\r\n    onCreateUserButton (event) {\r\n        API.addUser(this.onUserCreated, this.state.user_name,  this.state.user_email.trim(), this.props.match.params.id );\r\n        this.setState( { editing: 'none', });\r\n        event.preventDefault();\r\n    }\r\n\r\n    onDeleteProject (event) {\r\n        API.deleteProject(()=>{ this.setState( { is_deleted: true }); }, this.props.match.params.id);\r\n        this.setState( { editing: 'none', is_deleting: true });\r\n        event.preventDefault();\r\n    }\r\n\r\n    render () {\r\n        // неавторизованных пользователей перенаправляем на страницу логина\r\n        if ( !isAuthenticated() )\r\n            return (<Redirect to={{ pathname: \"/login\", state: { from: this.props.location }}} />);\r\n\r\n        // после удаление проекта переходим к списку проектов снова\r\n        if ( this.state.is_deleted )\r\n            return (<Redirect to='/' />);\r\n\r\n\r\n        // составляем два списка пользователей\r\n        let participants = [];\r\n        let others = [];\r\n\r\n        for (let i in this.state.users){\r\n            const p = this.state.users[i];\r\n            const animated = (p.id === this.state.moved_user);\r\n\r\n            if ( p.is_admin ) {\r\n                // игнорируем, у админов есть доступ везде\r\n            }\r\n            else if (this.state.participants.has(this.state.users[i].id))\r\n                participants.push(<User icon='delete' user={p} key={p.id} func={this.onDeleteUser} animated={animated}/>);\r\n            else\r\n                others.push(<User icon='add' user={p} key={p.id} func={this.onAddUser} animated={animated}/>);\r\n        }\r\n        \r\n        return ([\r\n            <Navbar key='navbar' />,\r\n            <Breadcrumbs key='breadcrumbs' name = {this.state.name}/>,            \r\n            <main key='body' role=\"main\" className=\"container\">\r\n                <ProjectDescription state= {this.state} clb={this} />\r\n                { !this.state.is_loaded || this.state.is_deleting || !getMe().is_admin ||\r\n                    <div className='d-flex flex-column flex-lg-row'>\r\n                        <div className='flex-fill my-4 mr-lg-4'>\r\n                            <h2 className='ml-3'>Участники проекта:</h2>\r\n                            <ul className=\"list-group shadow-lg\">\r\n                                {participants}\r\n                                <NewUser state={this.state}\r\n                                    handleInputChange={this.handleInputChange}\r\n                                    onNewUserButton={this.onNewUserButton}\r\n                                    onCreateUserButton={this.onCreateUserButton}\r\n                                    onCancelButton={this.onCancelButton} />\r\n                            </ul>\r\n                        </div>\r\n                        <div className='flex-fill my-4 ml-lg-4'>\r\n                            <h2 className='ml-3'>Остальные пользователи:</h2>\r\n                            <ul className=\"list-group shadow-lg\">\r\n                                {others}\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                }\r\n            </main>\r\n        ]);\r\n    }\r\n}\r\n","import React     from 'react';\r\nimport ReactDOM  from 'react-dom';\r\n\r\nimport App       from './App';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));","import React                              from 'react';\r\nimport { HashRouter as Router, Route }    from 'react-router-dom';\r\nimport Projects                           from './ProjectsList'\r\nimport Folder                             from './Folder';\r\nimport User                               from './User';\r\nimport NewProject                         from './NewProject';\r\nimport Project                            from './Project';\r\nimport { Login, Logout }                  from './Login'\r\nimport Alert                              from './Alert';\r\n\r\nexport default function App(props){\r\n    // ну а пока суть да дело - рисуем что можем\r\n    return (\r\n        <Router>\r\n            <div className=\"App\">\r\n                <Route exact path=\"/\" component={Projects} />\r\n                <Route path=\"/login\" component={Login} />\r\n                <Route path=\"/access_token=:hash\" component={Login} />\r\n                <Route path=\"/logout\" component={Logout} />\r\n                <Route path=\"/new_project\" component={NewProject} />\r\n                <Route path=\"/folder/:id\" render={ (props) => <Folder {...props}/> } />\r\n                <Route path=\"/project/:id\" render={ (props) => <Project {...props}/> } />\r\n                <Route path=\"/user/:id\" render={ (props) => <User {...props}/> } />\r\n                <Alert />\r\n            </div>\r\n        </Router>\r\n    );\r\n}"],"sourceRoot":""}