(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,a){e.exports=a(205)},107:function(e,t){},109:function(e,t){},144:function(e,t){},145:function(e,t){},191:function(e,t,a){},202:function(e,t,a){},203:function(e,t,a){},204:function(e,t,a){},205:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(96),s=a.n(l),o=a(5),i=a(27),c=a(6),m=a(7),d=a(10),u=a(8),h=a(9),p=a(97),f=a.n(p);function g(e){var t="https://www.gravatar.com/avatar/"+f.a.createHash("md5").update(e.email.trim().toLocaleLowerCase()).digest("hex")+"?d=identicon",a=void 0===e.size?"30px":e.size+"px",n=e.className||"";return r.a.createElement("img",{src:t,height:a,alt:"avatar",className:"rounded-circle "+n})}var b=a(20),v=a(1),E=null;function y(e){if(null===E)return null!==e?console.log("Error: setAlert() called before instantiating <Alert />, ignored. Message: ",e):void 0;E(e)}var N=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={errormsg:null},null!==E&&console.log("Warning: there can be only one instance of <Alert /> in application."),E=a.setMsg.bind(Object(v.a)(a)),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"componentWillUnmount",value:function(){E=null}},{key:"setMsg",value:function(e){this.setState({errormsg:e})}},{key:"render",value:function(){return null===this.state.errormsg?"":r.a.createElement("aside",{className:"fixed-bottom bg-danger border border-white text-white p-2",role:"alert"}," ",this.state.errormsg," ")}}]),t}(n.Component),_=/localhost/.test(window.location.origin)?"http://localhost:8000":"https://tomater.synology.me:8000";function j(e){switch(e.status){case 200:return e.json();case 401:return Promise.reject("Error 401: Token is not correct.");default:return Promise.reject("Server reply: "+e.status+"; "+e.statusText)}}function k(e){var t="Server-api/onError: unknown type of error...";"object"==typeof e?(console.log(e),t=e.message):"string"==typeof e&&(t=e),y(t)}var w={getProjectsList:function(e){return y(null),fetch(_+"/projects",{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},getProject:function(e,t){return y(null),fetch(_+"/projects/"+t,{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},addProject:function(e,t,a){return y(null),fetch(_+"/projects",{method:"post",body:JSON.stringify({name:t,description:a}),headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},updateProject:function(e,t,a,n){return y(null),fetch(_+"/projects/"+t,{method:"put",body:JSON.stringify({name:a,description:n}),headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},deleteProject:function(e,t){return y(null),fetch(_+"/projects/"+t,{method:"delete",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},addFolder:function(e,t,a){return y(null),fetch(_+"/folders",{method:"post",body:JSON.stringify({project:t,name:a}),headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},deleteFolder:function(e,t){return y(null),fetch(_+"/folders/"+t,{method:"delete",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(function(t){return e(t.id)}).catch(k)},getFolder:function(e,t){return y(null),fetch(_+"/folders/"+t,{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},getUsersList:function(e){return y(null),fetch(_+"/users",{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},addUser:function(e,t,a,n){return y(null),fetch(_+"/users",{method:"post",body:JSON.stringify({name:t,email:a,project:n}),headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},updateUserProjects:function(e,t,a,n){return y(null),fetch(_+"/users/"+t,{method:"put",body:JSON.stringify({project:a,action:n}),headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},updateUserName:function(e,t,a){return y(null),fetch(_+"/users/"+t,{method:"put",body:JSON.stringify({name:a}),headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},getMe:function(e){return y(null),fetch(_+"/users/me",{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},getUser:function(e,t){return y(null),fetch(_+"/users/"+t,{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},deleteUser:function(e,t){return y(null),fetch(_+"/users/"+t,{method:"delete",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},getVersion:function(e){return y(null),fetch(_+"/version",{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},updateServer:function(e){return y(null),fetch(_+"/version",{method:"post",headers:{"content-type":"application/json",Authorization:"Bearer "+B()}}).then(j).then(e).catch(k)},renewAccessToken:function(e,t,a){return y(null),fetch(_+"/auth/renewAccessToken",{method:"post",body:JSON.stringify({session_key:t}),headers:{"content-type":"application/json"}}).then(j).then(e).catch(a||k)},startEmailAuthentification:function(e,t,a){return y(null),fetch(_+"/auth/startEmailAuthentification",{method:"post",body:JSON.stringify({email:t}),headers:{"content-type":"application/json"}}).then(j).then(e).catch(a||k)},finishEmailAuthentification:function(e,t,a,n){return y(null),fetch(_+"/auth/finishEmailAuthentification",{method:"post",body:JSON.stringify({session_key:t,code:a}),headers:{"content-type":"application/json"}}).then(j).then(e).catch(n||k)},logout:function(e,t,a){return y(null),fetch(_+"/auth/logout",{method:"post",body:JSON.stringify({session_key:t}),headers:{"content-type":"application/json"}}).then(j).then(e).catch(a||k)},uploadFile:function(e,t,a,n,r){var l=new XMLHttpRequest;l.responseType="json",l.upload.addEventListener("progress",function(e){e.lengthComputable&&a(t.name,e.loaded/e.total*100)}),l.onload=function(){null===l.resonse?r(t.name,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438"):n(t.name,l.response)},l.upload.addEventListener("error",function(e){r(t.name,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438")});var s=new FormData;return s.append("file",t,t.name),s.append("folder",e),l.open("POST",_+"/files"),l.setRequestHeader("Authorization","Bearer "+B()),l.send(s),l},fileDownloadURL:function(e,t){return _+"/files/"+e+"?token="+t}},x=(a(191),null),C=0,O=null;function S(e){x=e.token,C=1e3*e.expiresIn+(new Date).getTime(),localStorage.setItem("session_key",e.session_key)}function B(){return x}function D(){return O}function U(){if(null===x||null===O)return!1;if((new Date).getTime()+6e5>=C){var e=localStorage.getItem("session_key");w.renewAccessToken(S,e)}return!0}var A=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={logged_in:U(),restoring_session:!1,return_to:{pathname:"/"},inputEmail:"",inputCode:"",wrong_email:!1,wrong_code:!1,code_sent:!1},a.handleInputChange=a.handleInputChange.bind(Object(v.a)(a)),a.performLogIn=a.performLogIn.bind(Object(v.a)(a)),void 0!==a.props.location.state&&(a.state.return_to=a.props.location.state.from);var n=localStorage.getItem("session_key");return null===x&&n&&(a.state.restoring_session=!0,localStorage.removeItem("session_key"),w.renewAccessToken(function(e){S(e),w.getMe(function(e){O=e,a.setState({logged_in:!0})})},n,function(){a.setState({restoring_session:!1})})),null!==x&&null===O&&w.getMe(function(e){O=e,a.setState({logged_in:!0})}),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"handleInputChange",value:function(e){var t,a=e.target;this.setState((t={},Object(b.a)(t,a.id,a.value),Object(b.a)(t,"wrong_email",!1),Object(b.a)(t,"wrong_code",!1),t))}},{key:"performLogIn",value:function(e){var t=this;!1===this.state.code_sent?w.startEmailAuthentification(function(e){t.setState({code_sent:!0,wrong_email:!1,temp_key:e.session_key})},this.state.inputEmail,function(){t.setState({code_sent:!1,wrong_email:!0})}):w.finishEmailAuthentification(function(e){S(e),t.setState({logged_in:!0})},this.state.temp_key,this.state.inputCode,function(){t.setState({wrong_code:!0})}),e.preventDefault()}},{key:"render",value:function(){var e=this.state.wrong_email,t=this.state.wrong_code;return this.state.logged_in?r.a.createElement(i.a,{to:this.state.return_to}):this.state.restoring_session?r.a.createElement("center",null,r.a.createElement("h4",{className:"p-4 text-muted"},"Logging in, please wait...")):r.a.createElement("main",null,r.a.createElement("form",{className:"form-signin text-center my-5",onSubmit:this.performLogIn},r.a.createElement("img",{className:"mb-4",src:"https://www.nodelfilms.com/assets/icons/nodelfilms-icon.svg",alt:"",width:"72",height:"72"}),r.a.createElement("h1",{className:"h3 mb-3 font-weight-normal"},"\u0412\u0445\u043e\u0434 \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"),this.state.code_sent&&r.a.createElement("p",{className:"text-secondary"},"\u041a\u043e\u0434 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0443\u044e \u043f\u043e\u0447\u0442\u0443. \u0414\u043b\u044f \u0432\u0445\u043e\u0434\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u0432 \u043f\u043e\u043b\u0435 \u043d\u0438\u0436\u0435:"),r.a.createElement("div",{className:"input-group"},this.state.code_sent||r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},"@")),r.a.createElement("input",{type:this.state.code_sent?"hidden":"email",id:"inputEmail",className:e?"form-control is-invalid":"form-control",placeholder:"Email",value:this.state.inputEmail,onChange:this.handleInputChange,autoFocus:!0}),e&&r.a.createElement("div",{className:"invalid-feedback"},"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d")),r.a.createElement("input",{type:this.state.code_sent?"number":"hidden",id:"inputCode",className:t?"form-control is-invalid":"form-control",placeholder:"\u041a\u043e\u0434 \u0438\u0437 \u043f\u0438\u0441\u044c\u043c\u0430",value:this.state.inputCode,onChange:this.handleInputChange,autoFocus:!0}),t&&r.a.createElement("div",{className:"invalid-feedback"},"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043a\u043e\u0434"),r.a.createElement("button",{className:"btn btn-primary btn-block my-2",type:"submit",disabled:t},this.state.code_sent?" \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043a\u043e\u0434":" \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u043e\u0434 \u0434\u043b\u044f \u0432\u0445\u043e\u0434\u0430"),r.a.createElement("p",{className:"mt-5 mb-3 text-muted"},"\xa9 2019, nodelfilms.com")))}}]),t}(n.Component),F=Object(i.e)(function(e){if(null!==x){var t=function(){e.history.push("/login")},a=localStorage.getItem("session_key");return O=null,x=null,localStorage.removeItem("session_key"),w.logout(t,a,t),r.a.createElement("center",null,r.a.createElement("h4",{className:"p-4 text-muted"},"Logging out, please wait..."))}return r.a.createElement(i.a,{to:"/login"})});function I(e){return e.where===e.to?r.a.createElement("li",{className:"nav-item active"},r.a.createElement("div",{className:"nav-link"},e.text)):r.a.createElement("li",{className:"nav-item"},r.a.createElement(o.b,{className:"nav-link",to:e.to},e.text))}function L(e){var t=void 0!==e.me?e.me:D();return r.a.createElement("nav",{className:"navbar navbar-expand-sm navbar-dark bg-dark"},r.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},r.a.createElement("span",{className:"navbar-toggler-icon"})),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarNav"},r.a.createElement("ul",{className:"navbar-nav"},r.a.createElement(i.b,{render:function(e){return r.a.createElement(I,{where:e.location.pathname,text:"\u041d\u0430\u0447\u0430\u043b\u043e",to:"/"})}}),t.is_admin&&r.a.createElement(i.b,{render:function(e){return r.a.createElement(I,{where:e.location.pathname,text:"\u041d\u043e\u0432\u044b\u0439 \u043f\u0440\u043e\u0435\u043a\u0442",to:"/new_project"})}}),r.a.createElement(i.b,{render:function(e){return r.a.createElement(I,{where:e.location.pathname,text:"\u0412\u044b\u0439\u0442\u0438",to:"/logout"})}}))),r.a.createElement("li",{className:"navbar-text dropdown"},r.a.createElement(g,{email:t.email,size:"30"}),r.a.createElement("span",{className:"ml-2"},r.a.createElement(o.b,{to:"/user/"+t.id,className:"text-white-50"},t.name))))}var z=a(21),P=a.n(z),T=a(24),M=a.n(T),J=a(25),R=a.n(J),q=(a(202),R()(M.a));function W(e){var t=0===e.files_num,a=t?"img/folder-empty.svg":"img/folder.svg",n=!0===e.animate?"folder-animated ":"";return r.a.createElement("div",{className:n+"list-group-item",key:e.id},r.a.createElement("div",{className:"d-flex w-100 justify-content-between"},r.a.createElement("div",{className:"media"},r.a.createElement(o.b,{to:"/folder/"+e.id,className:"align-self-center"},r.a.createElement("img",{src:a,className:"mr-3",height:"66",alt:"folder"})),r.a.createElement("div",{className:"media-body"},r.a.createElement(o.b,{to:"/folder/"+e.id,className:"text-dark"},r.a.createElement("h4",{className:"mt-0 mb-0 text-break"},e.name)),r.a.createElement("small",null,t?r.a.createElement("p",{className:"mb-0 text-secondary"},"\u041d\u0435\u0442 \u0444\u0430\u0439\u043b\u043e\u0432"):r.a.createElement("p",{className:"mb-0 text-secondary"},"\u0424\u0430\u0439\u043b\u043e\u0432: ",e.files_num),r.a.createElement("p",{className:"mb-0 text-secondary"},r.a.createElement(P.a,{date:e.updated,formatter:q}))))),t&&r.a.createElement("button",{type:"button",className:"close",onClick:e.callback,id:e.id},"\xd7")))}function H(e){return r.a.createElement("form",{className:"form-inline mt-3",autoComplete:"off",onSubmit:e.onAdd},r.a.createElement("label",{className:"sr-only",htmlFor:"folderName"},"Name"),r.a.createElement("input",{type:"text",maxLength:"50",className:"form-control mb-2 mr-sm-2",id:"folderName",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0430\u043f\u043a\u0438",onChange:e.onEdit,value:e.text}),e.text.length>0?r.a.createElement("button",{type:"submit",className:"btn btn-primary btn-sm mb-2 mr-2"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"):r.a.createElement("button",{type:"submit",className:"btn btn-primary btn-sm mb-2 mr-2",disabled:!0},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"),r.a.createElement("button",{className:"btn btn-primary btn-sm mb-2",onClick:e.onCancel},"\u041e\u0442\u043c\u0435\u043d\u0430"))}function Q(e){return r.a.createElement("div",null,r.a.createElement("div",{className:"row mt-3"},r.a.createElement("div",{className:"col-sm-8 mx-1"},r.a.createElement(o.b,{to:"/project/"+e.id,className:"text-dark mb-0"},r.a.createElement("h2",null," ",e.name))),r.a.createElement("div",{className:"col-sm mx-1 pt-sm-2 text-sm-right"},r.a.createElement("small",{className:"text-muted"},r.a.createElement(P.a,{date:e.updated,formatter:q})))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col mx-1"},r.a.createElement("p",{className:"mb-0"},e.description))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col mx-1"},e.new_folder||r.a.createElement("a",{href:"/#",onClick:e.onClick},r.a.createElement("small",null,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0430\u043f\u043a\u0443 \xbb")))))}var V=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state=e.project,a.state.new_folder=!1,a.state.new_folder_name="",a.onNewFolder=a.onNewFolder.bind(Object(v.a)(a)),a.onCancel=a.onButtonCancel.bind(Object(v.a)(a)),a.onAdd=a.onButtonAdd.bind(Object(v.a)(a)),a.handleInputChange=a.handleInputChange.bind(Object(v.a)(a)),a.onButtonAdd=a.onButtonAdd.bind(Object(v.a)(a)),a.onButtonDelete=a.onButtonDelete.bind(Object(v.a)(a)),a.onButtonCancel=a.onButtonCancel.bind(Object(v.a)(a)),a.folderAdded=a.folderAdded.bind(Object(v.a)(a)),a.folderDeleted=a.folderDeleted.bind(Object(v.a)(a)),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"onNewFolder",value:function(e){e.preventDefault(),this.setState({new_folder:!0,new_folder_name:""})}},{key:"onButtonAdd",value:function(e){e.preventDefault(),this.setState({new_folder:!1}),w.addFolder(this.folderAdded,this.state.id,this.state.new_folder_name)}},{key:"onButtonCancel",value:function(e){e.preventDefault(),this.setState({new_folder:!1})}},{key:"onButtonDelete",value:function(e){e.preventDefault(),w.deleteFolder(this.folderDeleted,e.target.id)}},{key:"folderAdded",value:function(e){for(var t=this.state.folders,a=0;a<t.length;a++)t[a].animate=!1,t[a].id===e.id&&(t.splice(a,1),a--);e.animate=!0,t.unshift(e),this.setState({folders:t})}},{key:"folderDeleted",value:function(e){var t=[];for(var a in this.state.folders)this.state.folders[a].id!==e&&t.push(this.state.folders[a]);this.setState({folders:t})}},{key:"handleInputChange",value:function(e){switch(e.target.id){case"folderName":this.setState({new_folder_name:e.target.value})}}},{key:"render",value:function(){var e=this.state.folders.sort(function(e,t){return new Date(t.updated)-new Date(e.updated)}),t=[];for(var a in e){var n=e[a];n.callback=this.onButtonDelete,t.push(W(n))}return r.a.createElement("div",{className:"mb-4"},r.a.createElement(Q,{id:this.state.id,name:this.state.name,updated:this.state.updated,onClick:this.onNewFolder,new_folder:this.state.new_folder}),this.state.new_folder&&r.a.createElement(H,{onAdd:this.onButtonAdd,onCancel:this.onButtonCancel,onEdit:this.handleInputChange,text:this.state.new_folder_name}),r.a.createElement("div",{className:"list-group shadow mt-3"},t))}}]),t}(n.Component),X=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={projects:null,loading:!0},a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){var e=this;U()&&w.getProjectsList(function(t){e.setState({projects:t,loading:!1})})}},{key:"render",value:function(){if(!U())return r.a.createElement(i.a,{to:{pathname:"/login",state:{from:this.props.location}}});var e=[];return null!==this.state.projects&&(e=this.state.projects.map(function(e){return r.a.createElement(V,{project:e,key:e.id})})),[r.a.createElement(L,{key:"navbar"}),r.a.createElement("main",{key:"body",role:"main",className:"container"},e,this.state.loading||e.length>0||r.a.createElement("center",{className:"p-4"},r.a.createElement("img",{className:"m-4",src:"http://nodelfilms.com/assets/icons/nodelfilms-icon.svg",alt:"",width:"72",height:"72"}),r.a.createElement("h3",null,"\u0412\u044b \u0441\u0435\u0439\u0447\u0430\u0441 \u043d\u0435 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442\u0435 \u043d\u0438 \u0432 \u043e\u0434\u043d\u043e\u043c \u0438\u0437 \u043f\u0440\u043e\u0435\u043a\u0442\u043e\u0432."),r.a.createElement("p",null,"\u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u043d\u0435 \u0442\u0430\u043a, \u0442\u043e \u0441\u0432\u044f\u0436\u0438\u0442\u0435\u0441\u044c \u0441 \u043d\u0430\u043c\u0438, \u0447\u0442\u043e\u0431\u044b \u043c\u044b \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u043b\u0438 \u0412\u0430\u043c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430.")))]}}]),t}(n.Component),Z=(a(203),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={hightlight:""},a.fileInputRef=r.a.createRef(),a.openFileDialog=a.openFileDialog.bind(Object(v.a)(a)),a.onFilesAdded=a.onFilesAdded.bind(Object(v.a)(a)),a.onDragOver=a.onDragOver.bind(Object(v.a)(a)),a.onDragLeave=a.onDragLeave.bind(Object(v.a)(a)),a.onDrop=a.onDrop.bind(Object(v.a)(a)),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"openFileDialog",value:function(){this.fileInputRef.current.click()}},{key:"onFilesAdded",value:function(e){for(var t=e.target.files,a=[],n=0;n<t.length;n++)a.push(t.item(n));this.props.onFilesAdded&&this.props.onFilesAdded(a)}},{key:"onDrop",value:function(e){e.preventDefault();for(var t=e.dataTransfer.files,a=[],n=0;n<t.length;n++)a.push(t.item(n));this.props.onFilesAdded&&this.props.onFilesAdded(a),this.setState({hightlight:""})}},{key:"onDragOver",value:function(e){e.preventDefault(),this.setState({hightlight:"ZoneHighlight"})}},{key:"onDragLeave",value:function(){this.setState({hightlight:""})}},{key:"render",value:function(){return r.a.createElement("div",{className:"p-1 "+this.state.hightlight,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDrop},this.props.children,r.a.createElement("div",{className:"d-flex w-100 flex-column align-items-center my-4 p-4 Dropzone"},r.a.createElement("img",{src:"img/cloud-upload.svg",alt:"upload",height:"150",onClick:this.openFileDialog,style:{cursor:"pointer"}}),r.a.createElement("input",{ref:this.fileInputRef,className:"InvisibleFileInput",type:"file",multiple:!0,onChange:this.onFilesAdded}),r.a.createElement("button",{type:"button",className:"btn btn-secondary btn-lg mb-3",onClick:this.openFileDialog},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0444\u0430\u0439\u043b\u044b"),r.a.createElement("center",null,r.a.createElement("p",null,"\u0418\u043b\u0438 \u043f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0444\u0430\u0439\u043b\u044b \u0441\u044e\u0434\u0430 \u0434\u043b\u044f \u0437\u0430\u043a\u0430\u0447\u043a\u0438"))))}}]),t}(n.Component)),G=a(37),K=a.n(G),Y=R()(M.a);function $(e){var t;return t=e.queued?function(e){return r.a.createElement("div",{className:"d-flex w-100"},r.a.createElement("div",{className:"align-self-center mx-3"},r.a.createElement("img",{src:"img/cloud-upload-light.svg",height:"50",alt:"upload"})),r.a.createElement("div",{className:"d-flex w-100 flex-column flex-md-row align-items-md-center"},r.a.createElement("h4",{className:"text-dark my-0 mr-3 text-break text-muted"},e.name),r.a.createElement("small",{className:"flex-grow-1 mr-2 text-secondary"},"\u0412 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u043d\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443")),r.a.createElement("button",{type:"button",className:"close mr-2",onClick:e.callback,id:e.index},"\xd7"))}(e):e.uploading?function(e){return r.a.createElement("div",{className:"d-flex w-100"},r.a.createElement("div",{className:"align-self-center mx-3"},r.a.createElement("img",{src:"img/cloud-upload-gray.svg",height:"50",alt:"upload"})),r.a.createElement("div",{className:"d-flex w-100 flex-column flex-md-row align-items-md-center"},r.a.createElement("h4",{className:"text-dark my-0 mr-3 text-break text-muted"},e.name),r.a.createElement("div",{className:"progress flex-grow-1 mr-2",style:{height:"22px"}},r.a.createElement("div",{className:"progress-bar progress-bar-striped progress-bar-animated",style:{width:e.progress+"%"}},Math.round(e.progress)+"%"))),r.a.createElement("button",{type:"button",className:"close mr-2",onClick:e.callback,id:e.index},"\xd7"))}(e):e.error?function(e){return r.a.createElement("div",{className:"d-flex w-100"},r.a.createElement("div",{className:"align-self-center mx-3"},r.a.createElement("img",{src:"img/error.svg",height:"50",alt:"upload"})),r.a.createElement("div",{className:"d-flex w-100 flex-column flex-md-row align-items-md-center"},r.a.createElement("h4",{className:"text-dark my-0 mr-3 text-break text-muted"},e.name),r.a.createElement("small",{className:"flex-grow-1 mr-2 text-secondary"},e.error_text)),r.a.createElement("button",{type:"button",className:"close mr-2",onClick:e.callback,id:e.index},"\xd7"))}(e):function(e){return r.a.createElement("div",{className:"d-flex w-100"},r.a.createElement("a",{download:!0,href:w.fileDownloadURL(e.id,e.token),className:"align-self-center mx-3"},r.a.createElement("img",{src:"img/cloud-download.svg",height:"50",alt:"download"})),r.a.createElement("div",{className:"d-flex w-100 flex-column flex-md-row align-items-md-center"},r.a.createElement("a",{download:!0,ref:e.saveRef,href:w.fileDownloadURL(e.id,e.token),className:"flex-grow-1 text-dark"},r.a.createElement("h4",{className:"my-0 mr-2 text-break"},e.name)),r.a.createElement("div",{className:"d-flex flex-column flex-md-row"},r.a.createElement("small",{className:"mx-md-2 mx-0 text-body text-break"},K()(e.size)),r.a.createElement("small",{className:"mx-md-2 mx-0 text-secondary text-break"},r.a.createElement(P.a,{date:e.uploaded,formatter:Y})),r.a.createElement("small",{className:"mr-md-2 mx-0 text-secondary text-break"},e.user))))}(e),r.a.createElement("div",{key:e.index,className:"list-group-item p-1"},t)}function ee(e){if(e>10&&e<15)return e+" \u0441\u0435\u043a\u0443\u043d\u0434";switch(e%10){case 1:return e+" \u0441\u0435\u043a\u0443\u043d\u0434\u0430";case 2:case 3:case 4:return e+" \u0441\u0435\u043a\u0443\u043d\u0434\u044b";default:return e+" \u0441\u0435\u043a\u0443\u043d\u0434"}}function te(e){if(e>10&&e<15)return e+" \u043c\u0438\u043d\u0443\u0442";switch(e%10){case 1:return e+" \u043c\u0438\u043d\u0443\u0442\u0430";case 2:case 3:case 4:return e+" \u043c\u0438\u043d\u0443\u0442\u044b";default:return e+" \u043c\u0438\u043d\u0443\u0442"}}function ae(e){var t=e.stats.uploaded_so_far;for(var a in e.stats.files){var n=e.stats.files[a];n.uploading&&(t+=n.size*n.progress/100)}var l=0,s=0;e.stats.uploading_now&&(l=(100*(e.stats.total_to_upload-t)/e.stats.total_to_upload).toFixed(1),s=((new Date).getTime()-e.stats.upload_started.getTime())/t*(e.stats.total_to_upload-t+1));return r.a.createElement("div",{className:"d-flex flex-wrap w-100 justify-content-left my-2"},r.a.createElement("small",{className:"mr-3 flex-grow-1"},e.stats.files.length>0&&e.stats.files.length<6&&!e.stats.uploading_now&&[r.a.createElement("a",{download:!0,href:"/#",onClick:function(t){for(var a in t.preventDefault(),console.log(e.linkrefs),e.linkrefs)setTimeout(function(e){e.click()},300*a,e.linkrefs[a])}},"\u0421\u043a\u0430\u0447\u0430\u0442\u044c \u043f\u043e \u043e\u0434\u043d\u043e\u043c\u0443 \xbb"),r.a.createElement("a",{className:"mr-3"})],e.stats.files.length>3&&!e.stats.uploading_now&&r.a.createElement("a",{download:!0,href:w.fileDownloadURL(e.stats.id,e.stats.zip_token)},"\u0421\u043a\u0430\u0447\u0430\u0442\u044c \u0432\u0441\u0435 (zip) \xbb")),r.a.createElement("div",{className:"mx-1 text-body"},e.stats.uploading_now?r.a.createElement("small",null,r.a.createElement("span",{className:"text-secondary"}," \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c "),K()(e.stats.total_to_upload),r.a.createElement("span",{className:"text-secondary"},", \u043e\u0441\u0442\u0430\u043b\u043e\u0441\u044c "),l+"%, ",function(e){var t=e/1e3,a=t/3600,n=t/60,r=Math.floor(a),l=Math.floor(n)%60,s=Math.floor(t)%60;return a>=5?r+" \u0447\u0430\u0441\u043e\u0432":a>=2?r+" \u0447\u0430\u0441\u0430 "+te(l):a>=1?"1 \u0447\u0430\u0441 "+te(l):l>=3?te(l):l>=1?te(l)+" "+ee(s):ee(s)}(s)):r.a.createElement("small",null,e.stats.files.length,r.a.createElement("span",{className:"text-secondary"}," \u0444\u0430\u0439\u043b\u0430(\u043e\u0432), "),K()(e.stats.total_uploaded))))}function ne(e){return r.a.createElement("nav",{"aria-label":"breadcrumb"},r.a.createElement("ol",{className:"breadcrumb mb-2"},r.a.createElement("li",{className:"breadcrumb-item"},r.a.createElement(o.b,{to:"/"},"\u0412\u0441\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u044b")),void 0!==e.parent_id&&r.a.createElement("li",{className:"breadcrumb-item"},r.a.createElement(o.b,{to:"/project/"+e.parent_id},e.parent_name)),r.a.createElement("li",{className:"breadcrumb-item active","aria-current":"page"},e.name)))}var re=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={name:null,id:a.props.match.params.id,zip_token:null,parent_id:null,files:[],uploading_now:!1,upload_started:null,uploaded_so_far:0,total_to_upload:0,total_uploaded:0},a.onFilesAdded=a.onFilesAdded.bind(Object(v.a)(a)),a.onCancelFile=a.onCancelFile.bind(Object(v.a)(a)),a.onFileUpoaded=a.onFileUpoaded.bind(Object(v.a)(a)),a.onUploadProgress=a.onUploadProgress.bind(Object(v.a)(a)),a.onUploadError=a.onUploadError.bind(Object(v.a)(a)),a.onFileListLoaded=a.onFileListLoaded.bind(Object(v.a)(a)),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){U()&&w.getFolder(this.onFileListLoaded,this.props.match.params.id)}},{key:"onFileListLoaded",value:function(e){var t=0;for(var a in e.files)t+=e.files[a].size;this.setState({name:e.name,parent_id:e.parent_id,parent_name:e.parent_name,files:e.files,zip_token:e.zip_token,total_uploaded:t})}},{key:"onFilesAdded",value:function(e){var t=[],a=0;for(var n in e){var r=!1;for(var l in this.state.files)if(!0!==this.state.files[l].error&&this.state.files[l].name===e[n].name){r=!0,t.push({name:e[n].name,error:!0,error_text:"\u0424\u0430\u0439\u043b \u0441 \u0442\u0430\u043a\u0438\u043c \u0438\u043c\u0435\u043d\u0435\u043c \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u0432 \u044d\u0442\u043e\u0439 \u043f\u0430\u043f\u043a\u0435."});break}if(!1===r){var s={name:e[n].name,size:e[n].size,file:e[n],queued:!0};t.push(s),a+=e[n].size}}this.setState(function(e){return{files:e.files.concat(t),total_to_upload:e.total_to_upload+a}}),this.rollQueue()}},{key:"rollQueue",value:function(){var e=this;U()&&this.setState(function(t){var a=t.files,n=0;for(var r in a)a[r].uploading&&n++;for(;n<3;){var l=null;for(var s in a)if(a[s].queued){l=s;break}if(null===l)break;var o=w.uploadFile(e.props.match.params.id,a[l].file,e.onUploadProgress,e.onFileUpoaded,e.onUploadError);a[l]={name:a[l].name,size:a[l].size,uploading:!0,progress:0,ref:o},n++}if(!t.uploading_now&&n>0){var i=0;for(var c in a)(a[c].uploading||a[c].queued)&&(i+=a[c].size);return{files:a,uploading_now:!0,upload_started:new Date,total_to_upload:i,uploaded_so_far:0}}return{files:a,uploading_now:n>0}})}},{key:"onCancelFile",value:function(e){e.preventDefault();var t=e.target.id;this.state.files[t].uploading&&this.state.files[t].ref.abort(),this.setState(function(e){var a=e.files,n=a[t].size;return a.splice(t,1),{files:a,total_to_upload:e.total_to_upload-n}}),this.rollQueue()}},{key:"onFileUpoaded",value:function(e,t){this.setState(function(a){var n=a.files,r=0;for(var l in n){var s=n[l];if(s.uploading&&s.name===e){void 0!==t.error?n[l]={name:e,error:!0,error_text:t.error}:n[l]=t,r+=s.size;break}}return{files:n,uploaded_so_far:a.uploaded_so_far+r,total_uploaded:a.total_uploaded+r}}),this.rollQueue()}},{key:"onUploadProgress",value:function(e,t){this.setState(function(a){var n=a.files;for(var r in n){var l=n[r];l.uploading&&l.name===e&&(n[r].progress=t)}return{files:n}})}},{key:"onUploadError",value:function(e,t){this.setState(function(a){var n=a.files;for(var r in n){var l=n[r];l.uploading&&l.name===e&&(n[r]={name:e,error:!0,error_text:t})}return{files:n}})}},{key:"render",value:function(){if(!U())return r.a.createElement(i.a,{to:{pathname:"/login",state:{from:this.props.location}}});var e=[],t=function(t){e.push(t)},a=[];for(var n in this.state.files){var l=this.state.files[n];l.index=n,l.callback=this.onCancelFile,l.saveRef=t,a.push($(l))}return[r.a.createElement(L,{key:"navbar"}),r.a.createElement(ne,{key:"breadcrumbs",parent_id:this.state.parent_id,parent_name:this.state.parent_name,name:this.state.name}),r.a.createElement("main",{key:"body",role:"main",className:"container"},r.a.createElement(ae,{stats:this.state,linkrefs:e}),r.a.createElement(Z,{onFilesAdded:this.onFilesAdded},r.a.createElement("div",{className:"list-group shadow"},a)))]}}]),t}(n.Component),le=R()(M.a);function se(e){var t=e.state,a=t.editing,n=[];if(void 0!==t.project_names)for(var l in t.project_names)n.push(r.a.createElement("strong",{key:l},t.project_names[l])),l<t.project_names.length-1&&n.push(", ");return r.a.createElement("div",{className:"border shadow-lg rounded-lg bg-white mt-4 p-4"},r.a.createElement("div",{className:"d-flex"},t.is_loaded&&r.a.createElement(g,{email:t.email,size:"120",className:"pr-4"}),r.a.createElement("div",{className:"flex-fill"},"name"!==a&&r.a.createElement("span",{className:"d-flex justify-content-between"},r.a.createElement("h1",{className:"display-4 text-break"},t.name),r.a.createElement("button",{className:"close",disabled:t.is_deleting||!t.is_loaded},r.a.createElement("img",{src:"img/edit.svg",className:"align-self-start mt-0 ml-sm-5",onClick:t.is_deleting?function(){}:e.clb.onEditNameButton,alt:"edit"}))),"name"===a&&r.a.createElement("form",{className:"form-inline mb-4",onSubmit:e.clb.onNameChangeButton,autoComplete:"off"},r.a.createElement("div",{className:"form-group flex-grow-1"},r.a.createElement("input",{type:"text",className:"form-control w-100 mr-2",id:"nameEdit",maxLength:"50",autoFocus:!0,onChange:e.clb.handleInputChange,value:t.nameEdit})),r.a.createElement("div",null,r.a.createElement("button",{type:"reset",className:"btn btn-secondary mr-2",onClick:e.clb.onCancelButton},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"))),r.a.createElement("span",{className:"d-flex justify-content-between"},r.a.createElement("p",{className:"lead text-break"},t.email)))),r.a.createElement("hr",{className:"my-4"}),t.is_loaded&&t.is_admin&&r.a.createElement("div",null,r.a.createElement("p",null,"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u0441\u0435\u0440\u0432\u0438\u0441\u0430. \u0418\u043c\u0435\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f \u043a:"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044e \u043f\u0440\u043e\u0435\u043a\u0442\u043e\u0432"),r.a.createElement("li",null,"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044e \u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044e \u0432\u043d\u0435\u0448\u043d\u0438\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"),r.a.createElement("li",null,"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u043e\u043c \u0432\u043d\u0435\u0448\u043d\u0438\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043a \u043f\u0440\u043e\u0435\u043a\u0442\u0430\u043c"),r.a.createElement("li",null,"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u043d\u043e\u0432\u044b\u0445 \u043f\u0430\u043f\u043e\u043a \u0432 \u043f\u0440\u043e\u0435\u043a\u0442\u0430\u0445"),r.a.createElement("li",null,"\u0421\u043a\u0430\u0447\u0438\u0432\u0430\u043d\u0438\u044e \u0444\u0430\u0439\u043b\u043e\u0432 \u0438\u0437 \u043f\u0430\u043f\u043e\u043a \u043f\u0440\u043e\u0435\u043a\u0442\u0430"),r.a.createElement("li",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u043d\u043e\u0432\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0432 \u043f\u0430\u043f\u043a\u0438"))),t.is_loaded&&!t.is_admin&&r.a.createElement("div",null,r.a.createElement("p",null,"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441\u0435\u0440\u0432\u0438\u0441\u0430. \u0418\u043c\u0435\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f \u043a:"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u043d\u043e\u0432\u044b\u0445 \u043f\u0430\u043f\u043e\u043a \u0432 \u043f\u0440\u043e\u0435\u043a\u0442\u0430\u0445"),r.a.createElement("li",null,"\u0421\u043a\u0430\u0447\u0438\u0432\u0430\u043d\u0438\u044e \u0444\u0430\u0439\u043b\u043e\u0432 \u0438\u0437 \u043f\u0430\u043f\u043e\u043a \u043f\u0440\u043e\u0435\u043a\u0442\u0430"),r.a.createElement("li",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u043d\u043e\u0432\u044b\u0445 \u0432\u0430\u0439\u043b\u043e\u0432 \u0432 \u043f\u0430\u043f\u043a\u0438")),n.length>0&&r.a.createElement("p",null,"\u042f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u043c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u043f\u0440\u043e\u0435\u043a\u0442\u043e\u0432: ",n,"."),0===n.length&&r.a.createElement("p",null,"\u0412 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u043d\u0435 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u043d\u0438 \u0432 \u043e\u0434\u043d\u043e\u043c \u0438\u0437 \u043f\u0440\u043e\u0435\u043a\u0442\u043e\u0432.")),!t.is_loaded||!D().is_admin||D().id===t.id||r.a.createElement("button",{className:"btn btn-danger btn-lg mt-3",disabled:t.is_deleting,onClick:e.clb.onDeleteUser},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"))}function oe(e){if("string"===typeof e.state)return r.a.createElement("div",{className:"border  shadow-lg rounded-lg bg-white mt-4 p-4"},r.a.createElement("h1",null,"\u0418\u0434\u0435\u0442 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430..."));var t=[];for(var a in e.state.updates)t.push(r.a.createElement("li",null,"(",r.a.createElement("strong",null,e.state.updates[a].hash),") ",r.a.createElement("i",null,"'",e.state.updates[a].name,"'")));return r.a.createElement("div",{className:"border  shadow-lg rounded-lg bg-white mt-4 p-4"},r.a.createElement("h1",null,"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430"),r.a.createElement("p",null,"\u0421\u0442\u0430\u0440\u0442\u043e\u0432\u0430\u043b ",r.a.createElement(P.a,{date:new Date(e.state.uptime_starts),formatter:le}),".",r.a.createElement("br",null),"\u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0440\u0435\u0432\u0438\u0437\u0438\u044f: (",r.a.createElement("strong",null,e.state.current_hash),") ",r.a.createElement("i",null,"'",e.state.current_name,"'"),", \u0437\u0430\u043a\u043e\u043c\u0438\u0447\u0435\u043d\u0430 ",r.a.createElement(P.a,{date:new Date(e.state.current_date),formatter:le}),".",r.a.createElement("br",null),0===e.state.updates.length&&r.a.createElement("span",null,"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \u043d\u0435\u0442.")),e.state.updates.length>0&&r.a.createElement("div",null,r.a.createElement("h3",null,"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f:"),r.a.createElement("ul",null," ",t," "),r.a.createElement("button",{className:"btn btn-danger btn-lg mt-3",onClick:e.clb},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")))}var ie=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={is_loaded:!1,editing:"none",name:"",email:"",is_deleting:!1,is_deleted:!1,me:D(),version_info:null},a.cached_id=a.props.match.params.id,a.handleInputChange=a.handleInputChange.bind(Object(v.a)(a)),a.onEditNameButton=a.onEditNameButton.bind(Object(v.a)(a)),a.onNameChangeButton=a.onNameChangeButton.bind(Object(v.a)(a)),a.onCancelButton=a.onCancelButton.bind(Object(v.a)(a)),a.onDeleteUser=a.onDeleteUser.bind(Object(v.a)(a)),a.onUpdateServer=a.onUpdateServer.bind(Object(v.a)(a)),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"loadUserInfo",value:function(){var e=this;w.getUser(function(t){t.is_loaded=!0,e.setState(t),e.state.me.is_admin&&e.state.me.email===t.email&&w.getVersion(function(t){return e.setState({version_info:t})})},this.props.match.params.id)}},{key:"componentWillMount",value:function(){U()&&this.loadUserInfo()}},{key:"componentDidUpdate",value:function(){this.cached_id!==this.props.match.params.id&&(this.cached_id=this.props.match.params.id,this.setState({is_loaded:!1}),this.loadUserInfo())}},{key:"handleInputChange",value:function(e){var t=e.target;this.setState(Object(b.a)({},t.id,t.value))}},{key:"onEditNameButton",value:function(e){this.setState({editing:"name",nameEdit:this.state.name})}},{key:"onNameChangeButton",value:function(e){var t=this;this.setState({editing:"none"}),w.updateUserName(function(){if(D().id===t.props.match.params.id){var e=D();e.name=t.state.nameEdit,function(e){O=e}(e)}t.setState({name:t.state.nameEdit,me:D()})},this.props.match.params.id,this.state.nameEdit),e.preventDefault()}},{key:"onCancelButton",value:function(e){this.setState({editing:"none"})}},{key:"onDeleteUser",value:function(e){var t=this;this.setState({editing:"none",is_deleting:!0}),w.deleteUser(function(){t.setState({is_deleted:!0})},this.props.match.params.id),e.preventDefault()}},{key:"onUpdateServer",value:function(e){var t=this;w.updateServer(function(){t.setState({version_info:"updating"}),setTimeout(function(){w.getVersion(function(e){return t.setState({version_info:e})})},15e3)})}},{key:"render",value:function(){return U()?this.state.is_deleted?r.a.createElement(i.a,{to:"/"}):[r.a.createElement(L,{key:"navbar",me:this.state.me}),r.a.createElement("main",{key:"body",role:"main",className:"container"},r.a.createElement(se,{state:this.state,clb:this}),this.state.version_info&&r.a.createElement(oe,{state:this.state.version_info,clb:this.onUpdateServer}))]:r.a.createElement(i.a,{to:{pathname:"/login",state:{from:this.props.location}}})}}]),t}(n.Component),ce=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={name:"",description:"",processing:!1,processed:!1,id:""},a.handleInputChange=a.handleInputChange.bind(Object(v.a)(a)),a.onCreate=a.onCreate.bind(Object(v.a)(a)),a.onCreated=a.onCreated.bind(Object(v.a)(a)),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"handleInputChange",value:function(e){var t=e.target;this.setState(Object(b.a)({},t.id,t.value))}},{key:"onCreate",value:function(e){w.addProject(this.onCreated,this.state.name,this.state.description),this.setState({processing:!0}),e.preventDefault()}},{key:"onCreated",value:function(e){this.setState({processed:!0,id:e.id})}},{key:"render",value:function(){return U()?this.state.processed?r.a.createElement(i.a,{to:"/project/"+this.state.id}):[r.a.createElement(L,{key:"navbar"}),r.a.createElement("main",{key:"body",role:"main",className:"container"},r.a.createElement("form",{onSubmit:this.onCreate,autoComplete:"off"},r.a.createElement("fieldset",{disabled:this.state.processing},r.a.createElement("h2",{className:"mt-3"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u043f\u0440\u043e\u0435\u043a\u0442"),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",id:"name",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",onChange:this.handleInputChange,value:this.state.name,required:!0})),r.a.createElement("div",{className:"form-group"},r.a.createElement("textarea",{className:"form-control",id:"description",rows:"3",placeholder:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 (\u043d\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e)",onChange:this.handleInputChange,value:this.state.description})),r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"))))]:r.a.createElement(i.a,{to:{pathname:"/login",state:{from:this.props.location}}})}}]),t}(n.Component),me=(a(204),R()(M.a));function de(e){var t="add"===e.icon?"img/add-user.svg":"img/delete-user.svg",a=e.animated?"user-animated":"";return r.a.createElement("li",{className:"list-group-item d-flex align-items-center "+a},r.a.createElement(g,{email:e.user.email,size:"80"}),r.a.createElement("div",{className:"flex-grow-1 text-break ml-3"},r.a.createElement(o.b,{to:"/user/"+e.user.id,className:"text-dark"},r.a.createElement("h5",null,e.user.name),r.a.createElement("span",null,e.user.email))),r.a.createElement("button",{className:"close",id:e.user.id,onClick:e.func},r.a.createElement("img",{src:t,id:e.user.id,height:"50px",className:"ml-2",alt:"move user"})))}function ue(e){var t=e.state.editing,a=function(e){if(void 0===e)return!1;var t=e.trim();if(t.length>50)return!1;var a=t.match(/\S+@\S+\.((?:com)|(?:ru))/);return null!==a&&a[0]===t}(e.state.user_email);return r.a.createElement("li",{className:"list-group-item d-flex align-items-center justify-content-center"},"user"===t||r.a.createElement("button",{className:"close"},r.a.createElement("img",{src:"img/add-new-user.svg",onClick:e.onNewUserButton,height:"50px",alt:"edit"})),"user"===t&&r.a.createElement("form",{className:"form-inline",onSubmit:e.onCreateUserButton,autoComplete:"off"},r.a.createElement("div",{className:"form-row w-100"},r.a.createElement("div",{className:"input-group mb-2 col-sm-6"},r.a.createElement("input",{type:"text",className:"form-control",id:"user_name",placeholder:"\u0418\u043c\u044f",maxLength:"50",onChange:e.handleInputChange,value:e.state.user_name,required:!0})),r.a.createElement("div",{className:"input-group mb-2 col-sm-6"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("div",{className:"input-group-text"},"@")),r.a.createElement("input",{type:"email",className:"form-control "+(a?"is-valid":"is-invalid"),id:"user_email",placeholder:"Email",maxLength:"50",onChange:e.handleInputChange,value:e.state.user_email,required:!0}))),r.a.createElement("div",{className:"form-row px-1"},r.a.createElement("button",{type:"reset",className:"btn btn-secondary mr-2",onClick:e.onCancelButton},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement("button",{type:"submit",className:"btn btn-primary"+(a?"":" disabled")},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"))))}function he(e){var t=e.state.editing;return r.a.createElement("div",{className:"border border-light shadow-lg rounded-lg bg-white mt-4 p-4"},"name"!==t&&r.a.createElement("span",{className:"d-flex justify-content-between"},r.a.createElement("h1",{className:"display-4 text-break"},e.state.name),!D().is_admin||e.state.folders_num>0||r.a.createElement("button",{className:"close",disabled:e.state.is_deleting||!e.state.is_loaded},r.a.createElement("img",{src:"img/edit.svg",className:"align-self-start mt-4 ml-3",onClick:e.state.is_deleting?function(){}:e.clb.onEditNameButton,alt:"edit"}))),"name"===t&&r.a.createElement("form",{className:"form-inline mb-4",onSubmit:e.clb.onNameChangeButton,autoComplete:"off"},r.a.createElement("div",{className:"form-group flex-grow-1"},r.a.createElement("input",{type:"text",className:"form-control w-100 mr-2",id:"nameEdit",autoFocus:!0,onChange:e.clb.handleInputChange,value:e.state.nameEdit})),r.a.createElement("div",null,r.a.createElement("button",{type:"reset",className:"btn btn-secondary mr-2",onClick:e.clb.onCancelButton},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"))),"description"!==t&&r.a.createElement("span",{className:"d-flex justify-content-between"},r.a.createElement("p",{className:"lead text-break"},e.state.description),!D().is_admin||r.a.createElement("button",{className:"close",disabled:e.state.is_deleting||!e.state.is_loaded},r.a.createElement("img",{src:"img/edit.svg",className:"align-self-start mt-3 ml-3",onClick:e.state.is_deleting?function(){}:e.clb.onEditDescButton,alt:"edit"}))),"description"===t&&r.a.createElement("form",{className:"form form mb-4",onSubmit:e.clb.onDescChangeButton,autoComplete:"off"},r.a.createElement("div",{className:"form-group flex-grow-1 mr-sm-4"},r.a.createElement("textarea",{className:"form-control w-100",id:"descEdit",rows:"5",autoFocus:!0,onChange:e.clb.handleInputChange,value:e.state.descEdit})),r.a.createElement("div",null,r.a.createElement("button",{type:"reset",className:"btn btn-secondary mr-2",onClick:e.clb.onCancelButton},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"))),r.a.createElement("hr",{className:"my-4"}),!e.state.is_loaded||r.a.createElement("p",null,"\u0421\u043e\u0437\u0434\u0430\u043d ",r.a.createElement("strong",null,r.a.createElement(P.a,{date:e.state.created,formatter:me})),r.a.createElement("br",null),"\u0421\u043e\u0434\u0435\u0440\u0436\u0438\u0442 ",r.a.createElement("strong",null,e.state.folders_num," \u043f\u0430\u043f\u043a\u0438"),", ",r.a.createElement("strong",null,e.state.files_num," \u0444\u0430\u0439\u043b\u0430(\u043e\u0432)"),"."),e.state.folders_num>0||!e.state.is_loaded||!D().is_admin||r.a.createElement("button",{className:"btn btn-danger btn-lg",disabled:e.state.is_deleting,onClick:e.clb.onDeleteProject},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0440\u043e\u0435\u043a\u0442"))}var pe=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={is_loaded:!1,editing:"none",name:"",description:"",participants:new Set,users:[],moved_user:"",is_deleting:!1,is_deleted:!1},a.handleInputChange=a.handleInputChange.bind(Object(v.a)(a)),a.onEditNameButton=a.onEditNameButton.bind(Object(v.a)(a)),a.onNameChangeButton=a.onNameChangeButton.bind(Object(v.a)(a)),a.onEditDescButton=a.onEditDescButton.bind(Object(v.a)(a)),a.onDescChangeButton=a.onDescChangeButton.bind(Object(v.a)(a)),a.onCancelButton=a.onCancelButton.bind(Object(v.a)(a)),a.onAddUser=a.onAddUser.bind(Object(v.a)(a)),a.onDeleteUser=a.onDeleteUser.bind(Object(v.a)(a)),a.onNewUserButton=a.onNewUserButton.bind(Object(v.a)(a)),a.onCreateUserButton=a.onCreateUserButton.bind(Object(v.a)(a)),a.onProjectLoaded=a.onProjectLoaded.bind(Object(v.a)(a)),a.onUserCreated=a.onUserCreated.bind(Object(v.a)(a)),a.onDeleteProject=a.onDeleteProject.bind(Object(v.a)(a)),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"onProjectLoaded",value:function(e){var t=e;"users"in e&&(t.participants=new Set(e.users),delete t.users),t.is_loaded=!0,this.setState(t)}},{key:"componentWillMount",value:function(){var e=this;U()&&(w.getProject(this.onProjectLoaded,this.props.match.params.id),D().is_admin&&w.getUsersList(function(t){e.setState({users:t})}))}},{key:"handleInputChange",value:function(e){var t=e.target;this.setState(Object(b.a)({},t.id,t.value))}},{key:"onEditNameButton",value:function(e){this.setState({editing:"name",nameEdit:this.state.name})}},{key:"onNameChangeButton",value:function(e){w.updateProject(this.onProjectLoaded,this.props.match.params.id,this.state.nameEdit,this.state.description),this.setState({editing:"none"}),e.preventDefault()}},{key:"onEditDescButton",value:function(e){this.setState({editing:"description",descEdit:this.state.description})}},{key:"onDescChangeButton",value:function(e){w.updateProject(this.onProjectLoaded,this.props.match.params.id,this.state.name,this.state.descEdit),this.setState({editing:"none"}),e.preventDefault()}},{key:"onNewUserButton",value:function(e){this.setState({editing:"user",user_name:"",user_email:""})}},{key:"onCancelButton",value:function(e){this.setState({editing:"none"})}},{key:"onAddUser",value:function(e){var t=this.state.participants;t.add(e.target.id),w.updateUserProjects(function(){},e.target.id,this.props.match.params.id,"add"),this.setState({editing:"none",participants:t,moved_user:e.target.id}),e.preventDefault()}},{key:"onDeleteUser",value:function(e){var t=this.state.participants;t.delete(e.target.id),w.updateUserProjects(function(){},e.target.id,this.props.match.params.id,"delete"),this.setState({editing:"none",participants:t,moved_user:e.target.id}),e.preventDefault()}},{key:"onUserCreated",value:function(e){var t=this.state.users,a=this.state.participants;t.push(e),a.add(e.id),this.setState({participants:a,users:t,moved_user:e.id,editing:"none"})}},{key:"onCreateUserButton",value:function(e){w.addUser(this.onUserCreated,this.state.user_name,this.state.user_email.trim(),this.props.match.params.id),this.setState({editing:"none"}),e.preventDefault()}},{key:"onDeleteProject",value:function(e){var t=this;w.deleteProject(function(){t.setState({is_deleted:!0})},this.props.match.params.id),this.setState({editing:"none",is_deleting:!0}),e.preventDefault()}},{key:"render",value:function(){if(!U())return r.a.createElement(i.a,{to:{pathname:"/login",state:{from:this.props.location}}});if(this.state.is_deleted)return r.a.createElement(i.a,{to:"/"});var e=[],t=[];for(var a in this.state.users){var n=this.state.users[a],l=n.id===this.state.moved_user;n.is_admin||(this.state.participants.has(this.state.users[a].id)?e.push(r.a.createElement(de,{icon:"delete",user:n,key:n.id,func:this.onDeleteUser,animated:l})):t.push(r.a.createElement(de,{icon:"add",user:n,key:n.id,func:this.onAddUser,animated:l})))}return[r.a.createElement(L,{key:"navbar"}),r.a.createElement(ne,{key:"breadcrumbs",name:this.state.name}),r.a.createElement("main",{key:"body",role:"main",className:"container"},r.a.createElement(he,{state:this.state,clb:this}),!this.state.is_loaded||this.state.is_deleting||!D().is_admin||r.a.createElement("div",{className:"d-flex flex-column flex-lg-row"},r.a.createElement("div",{className:"flex-fill my-4 mr-lg-4"},r.a.createElement("h2",{className:"ml-3"},"\u0423\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0438 \u043f\u0440\u043e\u0435\u043a\u0442\u0430:"),r.a.createElement("ul",{className:"list-group shadow-lg"},e,r.a.createElement(ue,{state:this.state,handleInputChange:this.handleInputChange,onNewUserButton:this.onNewUserButton,onCreateUserButton:this.onCreateUserButton,onCancelButton:this.onCancelButton}))),r.a.createElement("div",{className:"flex-fill my-4 ml-lg-4"},r.a.createElement("h2",{className:"ml-3"},"\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438:"),r.a.createElement("ul",{className:"list-group shadow-lg"},t))))]}}]),t}(n.Component);s.a.render(r.a.createElement(function(e){return r.a.createElement(o.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(i.b,{exact:!0,path:"/",component:X}),r.a.createElement(i.b,{path:"/login",component:A}),r.a.createElement(i.b,{path:"/access_token=:hash",component:A}),r.a.createElement(i.b,{path:"/logout",component:F}),r.a.createElement(i.b,{path:"/new_project",component:ce}),r.a.createElement(i.b,{path:"/folder/:id",render:function(e){return r.a.createElement(re,e)}}),r.a.createElement(i.b,{path:"/project/:id",render:function(e){return r.a.createElement(pe,e)}}),r.a.createElement(i.b,{path:"/user/:id",render:function(e){return r.a.createElement(ie,e)}}),r.a.createElement(N,null)))},null),document.getElementById("root"))}},[[100,1,2]]]);
//# sourceMappingURL=main.9d29ddce.chunk.js.map